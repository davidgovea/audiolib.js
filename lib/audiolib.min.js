this.audioLib=(function AUDIOLIB(x,k,B,q){var t=x.Float32Array||q,e=this;function d(E){var F=new t(E);F.subarray=F.subarray||F.slice;return F}e.Float32Array=d;var C=(function(){if(B.defineProperty){return B.defineProperty}else{if(B.prototype.__defineGetter__){return function(E,G,F){F.get&&E.__defineGetter__(G,F.get);F.set&&E.__defineSetter__(G,F.set)}}}}());function l(G,H,F,E){if(C){C(G,H,{get:function(){return F},enumerable:!!E})}else{G[H]=F}}l(e,"__define",C);l(e,"__defineConst",l);function u(H){var F=arguments,E=F.length,G,I;for(G=1;G<E;G++){for(I in F[G]){if(F[G].hasOwnProperty(I)){H[I]=F[G][I]}}}return H}l(e,"__extend",u);function r(F,H,G){var E;for(E in F){(F.hasOwnProperty(E)||G)&&H.call(F,F[E],E)}return F}l(e,"__enum",r);function A(J,F,G,K,I){this.attack=F||50;this.decay=G||50;this.sustain=K||1;this.release=I||50;this.value=0;var M=this,E=3,H=false,L=[function(){M.value+=1000/M.sampleRate/M.attack;if(M.value>=1){E=1}},function(){M.value-=1000/M.sampleRate/M.decay*M.sustain;if(M.value<=M.sustain){E=2}},function(){M.value=M.sustain},function(){M.value=k.max(0,M.value-1000/M.sampleRate/M.release)}];this.generate=function(){L[E]();return this.value};this.triggerGate=function(N){H=N;E=H?0:3};this.sampleRate=J}function D(){var M=this,J=[];this.velocity=0;this.legato=0;this.retrigger=0;this.polyphony=1;this.activeKeys=[];this.voices=[];this.pitchBend=0;function K(N,O){this.key=N;this.velocity=O;this.noteOff=function(){};this.onKeyChange=function(){};this.changeKey=function(Q,P){this.key=Q;this.v=P;this.onKeyChange()};this.getFrequency=function(){return M.getFrequencyForKey(this.key)};M.voice.apply(this)}function H(O){var N;for(N=0;N<J.length;N++){if(J[N].key===O){J.splice(N--,1)}}}function L(N,O){H(N);J.push({key:N,velocity:O})}function F(){var N,P,O=[];if(M.legato===0){O=J.slice(0)}else{if(M.legato===1){for(N=0;N<J.length;N++){for(P=0;P<O.length;P++){if(P===J.length-1||(O[P-1].key>J[N].key&&O[P].key<J[N].key)){O.splice(P,0,J[N]);break}}}}else{if(M.legato===2){for(N=0;N<J.length;N++){for(P=0;P<O.length;P++){if(P===J.length-1||(O[P-1].key<J[N].key&&O[P].key>J[N].key)){O.splice(P,0,J[N]);break}}}}}}M.activeKeys=O.slice(-M.polyphony)}function E(){if(!M.voice){return}var N,P,O;if(M.polyphony===1&&M.activeKeys.length>0){N=M.activeKeys.length-1;if(M.voices.length===0){M.voices.push(new K(M.activeKeys[N].key,M.activeKeys[N].velocity))}else{M.voices[0].changeKey(M.activeKeys[N].key,M.activeKeys[N].velocity)}}else{for(P=0;P<M.activeKeys.length;P++){O=false;for(N=0;N<M.voices.length;N++){if(M.voices[N].key===M.activeKeys[P].key){O=true;break}}if(!O){M.voices.push(new K(M.activeKeys[N].key,M.activeKeys[N].velocity))}}}for(N=0;N<M.voices.length;N++){O=false;for(P=0;P<M.activeKeys.length;P++){if(M.voices[N].key===M.activeKeys[P].key){O=true;break}}if(!O){M.voices[N].noteOff();M.voices.splice(N--,1)}}}function I(O,P){var N=M.activeKeys.length;L(O,P);F();E();M.onNoteOn(O,P);if(M.retrigger===0||(N===0&&M.activeKeys.length>0)){M.onTrigger()}}function G(N,O){H(N,O);F();E();M.onNoteOff(N,O);if(M.activeKeys===0){M.onRelease()}}this.onMidi=function(N){switch(N.status){case 9:I(N.data1,N.data2/127);break;case 8:G(N.data1,N.data2/127);break;case 14:M.pitchBend=(N.data1*128+N.data2-8192)/8192;break}};this.getFrequencyForKey=function(N){return 440*k.pow(1.059,N-69)};this.getFrequency=function(){var O=[],N;for(N=0;N<M.activeKeys.length;N++){O.push(M.getFrequencyForKey(M.activeKeys[N].key))}if(O.length>2){return O[0]}return O};this.onTrigger=function(){};this.onRelease=function(){};this.onNoteOn=function(){};this.onNoteOff=function(){};this.voice=null;this.listener=function(N){M.onMidi(N)}}function y(I,F,H,J){var G=this,E=0;G.sampleRate=I;G.stepLength=F||200;G.steps=H||[1,0];G.value=0;G.attack=J||0;G.generate=function(){var M=G.sampleRate/1000*G.stepLength,O=G.steps,N=M*O.length,Q,K,L,P,R;if(++E===N){E=0}Q=E/N*O.length;K=Q%1;Q=k.floor(Q);L=(Q||O.length)-1;P=O[Q]-O[L];R=O[Q];if(K<G.attack){R-=P-P/G.attack*K}G.value=R;return R};G.triggerGate=function(){E=0}}function s(M,E,H,I){var N=this,G=new d(E),F=E-1,K=H,L=0,J=0;this.volume=N.volume||1;N.sampleRate=M;N.pushSample=function(O){G[K++]=O;J=G[L++]*N.volume;if(K>=F){K=0}if(L>=F){L=0}return J};N.getMix=function(){return J}}function w(L,I,H,E){var M=this,G,F,K;M.delayTime=I||30;M.depth=H||3;M.freq=E||0.1;function J(){G=new d(M.sampleRate*0.1);F=0;var O,N=G.length;for(O=0;O<N;O++){G[O]=0}}M.sampleRate=L;M.osc=new c(L,E);M.calcCoeff=J;M.pushSample=function(O){if(++F>=G.length){F=0}G[F]=O;M.osc.generate();var N=M.delayTime+M.osc.getMix()*M.depth;N*=M.sampleRate/1000;N=F-k.floor(N);while(N<0){N+=G.length}K=G[N];return K};M.getMix=function(){return K};J()}function g(G,H,E){var F=this;F.time=isNaN(H)?F.time:H;F.feedback=isNaN(H)?F.feedback:E;F.reset(G)}g.prototype={sampleRate:1,bufferPos:0,buffer:null,time:1000,feedback:0,sample:0,_rstf:1,pushSample:function(G){var F=this,E=F.buffer;E[F.bufferPos++]+=G;if(F.bufferPos>F.time*F._rstf){F.bufferPos=0}F.sample=E[F.bufferPos];E[F.bufferPos]*=F.feedback;return F.sample},getMix:function(){return this.sample},resample:function(G){var E=this,F=E.time/G;E.buffer=e.Sampler.resample(E.buffer,G);E.time=G;E.bufferPos=k.round(F*E.bufferPos);return E.buffer},reset:function(G,J){var E=this,F=E.buffer,H,I;G=isNaN(G)?E.sampleRate:G;I=E.sampleRate/G;E.buffer=new d(G*g.MAX_DELAY);E.bufferPos=k.round(I*E.bufferPos);E._rstf=1/1000*G;if(J){F=e.Sampler.resample(F,I);for(H=0;H<F.length&&H<E.buffer.length;H++){E.buffer[H]=F[H]}}return E.buffer}};g.MAX_DELAY=2;function o(E){var I=new f(E,720.484),H=new f(E,723.431),G=new f(E,1),F=0;this.gain=4;this.master=1;this.sampleRate=E;this.filters=[I,H,G];this.pushSample=function(J){I.pushSample(J);F=I.getMix(1)*this.gain;F=k.atan(F)+F;if(F>0.4){F=0.4}else{if(F<-0.4){F=-0.4}}H.pushSample(F);G.pushSample(H.getMix(0));F=G.getMix(1)*this.master;return F};this.getMix=function(){return F}}(function(F,E){E.Capper=function(H,I){var G=this,J=0;G.sampleRate=H;G.cap=I||1;G.pushSample=function(K){J=K>G.cap?2*G.cap-K:K<-G.cap?-2*G.cap-K:K;return J};G.getMix=function(){return J}};E.Expo=function(H,I){var G=this;sample=0;G.sampleRate=H;G.param=I||0.8;G.pushSample=function(J){sample=(J<0?-k.pow(G.param*2,-J):k.pow(G.param*2,J))/10;return sample};G.getMix=function(){return sample}};E.Compressor=function(I,H,J){var G=this;sample=0;G.sampleRate=I;G.scale=H||1;G.gain=J||0.5;G.pushSample=function(K){K/=G.scale;sample=(1+G.gain)*K-G.gain*K*K*K;return sample};G.getMix=function(){return sample}}}(this,e));function f(J,F,Q,O){var R=this,L=[0,0,0,0],E,H,P,G,N=k.sin,I=k.min,K=k.pow;R.cutoff=!F?20000:F;R.resonance=!Q?0.1:Q;R.samplerate=J;R.type=O||0;function M(){E=2*N(k.PI*I(0.25,R.cutoff/(R.samplerate*2)));H=I(2*(1-K(R.resonance,0.25)),I(2,2/E-E*0.5))}R.pushSample=function(S){if(P!==R.cutoff||G!==R.resonance){M();P=R.cutoff;G=R.resonance}L[3]=S-H*L[2];L[0]=L[0]+E*L[2];L[1]=L[3]-L[0];L[2]=E*L[1]+L[2];L[3]=S-H*L[2];L[0]=L[0]+E*L[2];L[1]=L[3]-L[0];L[2]=E*L[1]+L[2];return L[R.type]};R.getMix=function(S){return L[S||R.type]}}function a(G,H,I){var E=this,F=[0,0];E.cutoff=!H?20000:H;E.resonance=!I?0:I;E.samplerate=G;E.pushSample=function(K){var J=E.cutoff*2/E.samplerate,L=E.resonance+E.resonance/(1-J);F[0]=F[0]+J*(K-F[0]+L*(F[0]-F[1]));F[1]=F[1]+J*(F[0]-F[1]);return F[1]};E.getMix=function(){return F[1]}}function v(J,G,Q){var R=this,O=0,I=0,L=k.PI*2,N,F,E,M,P,H;R.cutoff=!G?20000:G;R.resonance=!Q?1:Q;R.samplerate=J;function K(){N=L*R.cutoff/R.samplerate;F=1-N/(2*(R.resonance+0.5/(1+N))+N-2);E=F*F;M=E+1-2*k.cos(N)*F}R.pushSample=function(S){if(P!==R.cutoff||H!==R.resonance){K();P=R.cutoff;H=R.resonance}O+=(S-I)*M;I+=O;O*=E;return I};R.getMix=function(){return I};K()}function c(F,G){var E=this;E.frequency=isNaN(G)?440:G;E.waveTable=new d(1);E.sampleRate=F;E.waveShapes=E.waveShapes.slice(0)}(function(G,H,F,E){F=c.prototype={sampleRate:1,frequency:440,phase:0,phaseOffset:0,pulseWidth:0.5,fm:0,waveShape:"sine",_p:0,generate:function(){var I=this,K=+I.frequency,J=I.pulseWidth,L=I.phase;K+=K*I.fm;I.phase=(L+K/I.sampleRate/2)%1;L=(I.phase+I.phaseOffset)%1;I._p=L<J?L/J:(L-J)/(1-J)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(I){this.phase=this._p=isNaN(I)?0:I},setWavetable:function(I){this.waveTable=I;return true},sine:function(){return k.sin(this._p*G)},triangle:function(){return this._p<0.5?4*this._p-1:3-4*this._p},square:function(){return this._p<0.5?-1:1},sawtooth:function(){return 1-this._p*2},invSawtooth:function(){return this._p*2-1},pulse:function(){return this._p<0.5?this._p<0.25?this._p*8-1:1-(this._p-0.25)*8:-1},wavetable:function(){return e.Sampler.interpolate(this.wavetable,this._p*this.wavetable.length)},waveShapes:[]};for(E=0;E<H.length;E++){F[E]=F[H[E]];F.waveShapes.push(F[E])}c.WaveShape=function(J,I){if(I){this.prototype[J]=I}return this.prototype[J]};c.createMixWave=function(J,M){var I=M.length,L,K;return this.WaveShape(J,function(){L=0;for(K=0;K<I;K++){L+=this[M[K].shape]()*M[K].mix}return mix})}}(k.PI*2,["sine","triangle","pulse","sawtooth","invSawtooth","square"]));function b(F,G){var E=this;E.voices=[];E.sampleRate=F;E.pitch=isNaN(G)?440:E.pitch}b.prototype={sampleRate:1,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(J){J=isNaN(J)?this.pitch:J;var F=this,I=J/F.pitch,H=F.sampleRate,K=H*F.delayStart,E=F.sampleSize-H*F.delayEnd,G={f:J,p:K,s:I,l:E};F.voices.push(G);while(F.voices.length>F.maxVoices){E=F.voices.shift();E.onend&&E.onend()}return G},generate:function(){var E=this.voices,F,G;for(F=0;F<E.length;F++){G=E[F];G.p+=G.s;G.p>G.l&&E.splice(F--,1)&&G.onend&&G.onend()}},getMix:function(H){var E=this.voices,G=0,F;H=H||0;if(this.samples[H]){for(F=0;F<E.length;F++){G+=b.interpolate(this.samples[H],E[F].p)}}return G},load:function(I,H){var E=this,F=E.samples=b.splitChannels(I.data,I.channelCount),G;if(H){for(G=0;G<F.length;G++){F[G]=b.resample(F[G],I.sampleRate,E.sampleRate)}}E.sample=I.data;E.samples=F;E.data=I;E.sampleSize=F[0].length}};(function(){function E(F,G){if(F&&G){E[F]=G}else{if(F&&E[F] instanceof Function){b.interpolate=E[F]}}return E[F]}b.interpolation=E;E("linear",function(F,J){var I=k.floor(J),H=I+1,G=J-I;H=H<F.length?H:0;return F[I]*(1-G)+F[H]*G});E("nearest",function(F,G){return G>=F.length-0.5?F[0]:F[k.round(G)]});E("linear")}());b.resample=function(L,E,O,P,G){var K=arguments.length,I=K===2?E:K===3?P/O:P/E*G/O,J=L.length,F=k.ceil(J/I),N=new d(F),M,H;for(M=0,H=0;M<J;M+=I){N[H++]=b.interpolate(L,M)}return N};b.splitChannels=function(F,J){var E=F.length,I=E/J,G=[],H,K;for(H=0;H<J;H++){G[H]=new d(I);for(K=0;K<I;K++){G[H][K]=F[H*J+K]}}return G};b.joinChannels=function(G){var I=G.length,F=G[0].length,E=new d(F*I),H,J;for(H=0;H<I;H++){for(J=0;J<F;J++){E[H+J*I]=G[H][J]}}return E};function z(G,H,F){var E=this;E.notes=[];E.sampleRate=G;E.noteTime=isNaN(H)?250:H;E.noteLength=G*0.001*E.noteTime;E.zero=new d(E.noteLength);E.cb=F}z.prototype={pos:0,looping:false,generate:function(){var E=this,G,F;if((E.pos+=1)===E.noteLength){G=E.notes,F=G.shift();if(E.looping){G.push(F)}E.pos=0;E.cb()}},getMix:function(){var E=this,F=E.notes[0]||E.zero;return F[E.pos]},addNote:function(F){var E=this,I=E.noteLength,H=new d(I),G=0;for(G=0;G<I;G++){H[G]=F(G)}E.notes.push(H)},getNoteLength:function(){return this.noteLength},getNoteCount:function(){return this.notes.length-1},setLooping:function(E){this.looping=(typeof E==="undefined")?true:E},reset:function(){this.notes=[];this.pos=0}};(function(E){function J(Q){var S,R=Q.length,P={};for(S=0;S<R;S++){P[Q[S]]=true}return P}var M=J([256,512,1024,2048,4096,8192,16384]),F=J([48000,44100,22050]),O=String.fromCharCode;function N(U,T,S,R){var Q=N.devices,P;for(P in Q){if(Q.hasOwnProperty(P)&&Q[P].enabled){try{return new Q[P](U,T,S,R)}catch(V){}}}throw"No audio device available."}function G(P){this.boundTo=P;this.buffers=[];P.activeRecordings.push(this)}G.prototype={add:function(P){this.buffers.push(P)},clear:function(){this.buffers=[]},stop:function(){var P=this.boundTo.activeRecordings,Q;for(Q=0;Q<P.length;Q++){if(P[Q]===this){P.splice(Q--,1)}}},join:function(){var T=0,U=0,R=this.buffers,P,V,S,Q=R.length;for(S=0;S<Q;S++){T+=R[S].length}P=new d(T);for(S=0;S<Q;S++){for(V=0;V<R[S].length;V++){P[U+V]=R[S][V]}U+=R[S].length}return P}};function L(P){this.type=P}L.prototype={record:function(){return new G(this)},recordData:function(Q){var S=this.activeRecordings,R,P=S.length;for(R=0;R<P;R++){S[R].add(Q)}},writeBuffers:function(R){var Q=this.buffers,P=R.length,S,U,T,V;if(Q){for(T=0;T<Q.length;T++){S=Q[T];U=S.length;for(V=0;V<P&&V<U;V++){R[V]+=S[V]}Q[T]=S.subarray(V);T>=U&&Q.splice(T--,1)}}},writeBuffer:function(Q){var P=this.buffers=this.buffers||[];P.push(Q);return P.length}};function K(Z,W,Q,ab){ab=F[ab]?ab:44100;Q=M[Q]?Q:ab/2;var ad=this,S=0,aa=null,Y=new Audio(),X,V,U,T,P;function ac(aj,af){var ai,ah,ae;if(K.backgroundWork){if(window.MozBlobBuilder){ae=new MozBlobBuilder();ae.append('setInterval(function(){ postMessage("tic"); }, '+af+");");ah=window.URL.createObjectURL(ae.getBlob());ai=new Worker(ah);ai.onmessage=function(){aj()};return function(){ai.terminate();window.URL.revokeObjectURL(ah)}}ah=ae=+new Date+"";function ag(ak){if(ak.source===window&&ak.data===ah&&ae<+new Date){ae=+new Date+af;aj()}window.postMessage(ah,"*")}window.addEventListener("message",ag,true);window.postMessage(ah,"*");return function(){window.removeEventListener("message",ag)}}else{ai=setInterval(aj,af);return function(){clearInterval(ai)}}}function R(){if(aa){X=Y.mozWriteAudio(aa);S+=X;if(X<aa.length){aa=aa.subarray(X);return aa}aa=null}V=Y.mozCurrentSampleOffset();U=Number(V+Q*W-S)+0;if(U>0){T=new d(U);Z&&Z(T,ad.channelCount);ad.writeBuffers(T);ad.recordData(T);X=Y.mozWriteAudio(T);if(X<T.length){aa=T.subarray(X)}S+=X}}Y.mozSetup(W,ab);P=ac(R,20);this.kill=function(){P()};this.activeRecordings=[];this.sampleRate=ab;this.channelCount=W;this.type="moz"}K.enabled=true;K.backgroundWork=false;K.prototype=new L("moz");function I(W,U,S,R){R=F[R]?R:44100;S=M[S]?S:4096;var P=this,T=new (window.AudioContext||webkitAudioContext)(),V=T.createJavaScriptNode(S,0,U);function Q(ae){var X=ae.outputBuffer,aa=X.numberOfChannels,ac,Z,ab=X.length,af=X.size,ad=new q(aa),Y=new d(ab*aa);for(ac=0;ac<aa;ac++){ad[ac]=X.getChannelData(ac)}W&&W(Y,aa);P.writeBuffers(Y);P.recordData(Y);for(ac=0;ac<ab;ac++){for(Z=0;Z<aa;Z++){ad[Z][ac]=Y[ac*aa+Z]}}}V.onaudioprocess=Q;V.connect(T.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=T.sampleRate;this.channelCount=U;this._context=T;this._node=V;this._callback=Q;this.type="webkit"}I.enabled=true;I.prototype=new L("webkit");function H(U,T,S,R){R=F[R]?R:44100;S=M[S]?bufferSize:8192;var P=this,V;function Q(){var W=new d(S*T);U&&U(W,P.channelCount);P.writeBuffers(W);P.recordData(W)}this.kill=function(){clearInterval(V)};this.activeRecordings=[];setInterval(Q,S/R*1000);this.sampleRate=R;this.channelCount=T;this.type="dummy"}H.enabled=true;H.prototype=new L("dummy");N.deviceClass=L;N.propertyEnum=J;N.devices={moz:K,webkit:I,dummy:H};N.Recording=G;E.AudioDevice=N}(this));this.AudioDevice.createScheduled=function(I){var H=[],E=0,F;function G(K,N){var J=K.length/N,Q=F.chunkSize,M=Q*N,P,L,O;E=+new Date;for(L=0;L<J;L+=Q){for(P=0;P<H.length;P++){H[P].t-=Q;if(H[P].t<=0){H[P].f.apply(H[P].x,H[P].a);H.splice(P--,1)}}O=L*M;I(K.subarray(O,O+M),N)}}F=this.apply(this,[G].concat(q.prototype.splice.call(arguments,1)));F.schedule=function(L,K,J){H.push({f:L,x:K,a:J,t:((new Date-E)*0.001*this.sampleRate)})};F.chunkSize=1;return F};(function(){function E(){var G=arguments,F=G.length,I,H;for(H=0;H<F;H++){I=G[H];this.postMessage({type:"injection",code:I instanceof Function?"("+String(I)+").call(this);":I})}}e.AudioWorker=function(H,J){var F=new (window.MozBlobBuilder||window.BlobBuilder)(),G,I;F.append("var audioLib = ("+String(AUDIOLIB)+"(this, Math));\n");J&&F.append('this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)}, true);\n');F.append(H instanceof Function?"("+String(H)+").call(this);":H);G=window.URL.createObjectURL(F.getBlob());I=new Worker(G);I._terminate=I.terminate;I.terminate=function(){window.URL.revokeObjectURL(id);return I._terminate.call(I,arguments)};if(J){I.inject=E}return I}}());(function(F,G){var N=String.fromCharCode,L=true,H=false;function I(O,P){return P?N(O&255)+I(O>>8,P-1):""}function K(O,P){return P?K(O>>8,P-1)+N(255-O&255):""}function M(O,P,Q){return Q?K(O,P):I(O,P)}function E(T,S){var O=T.length,R=O-1,U=0,Q=G.pow,P;if(S){for(P=0;P<O;P++){U+=(255-T.charCodeAt(P))*Q(256,R-P)}}else{for(P=0;P<O;P++){U+=T.charCodeAt(P)*Q(256,P)}}return U}function J(S,X,R,aa){var W=G.pow,V=G.floor,P=J.convertFromBinary,Y=J.convertToBinary,O=S/8,U=W(2,S),Z=U/2,ab=Z-1,T=1/Z,Q=1/ab;return aa?R?X?function(ac,ad){ac=V(ac<0?ac*Z+U:ac*ab);return Y(ac,O,ad)}:function(ac,ad){return Y(V(ac*ab),O,ad)}:X?function(ac,ad){return Y(ac<0?ac+U:ac,O,ad)}:function(ac,ad){return Y(ac,O,ad)}:R?X?function(ae,ad){var ac=P(ae,ad);return ac>ab?(ac-U)*T:ac*Q}:function(ad,ac){return P(ad,ac)*Q}:X?function(ae,ad){var ac=P(ae,ad);return ac>ab?ac-U:ac}:function(ad,ac){return P(ad,ac)}}J.convertToBinary=M;J.convertFromBinary=E;J.fromFloat32=J(32,L,L,L);J.toFloat32=J(32,L,L,H);J.fromFloat24=J(24,L,L,L);J.toFloat24=J(24,L,L,H);J.fromFloat16=J(16,L,L,L);J.toFloat16=J(16,L,L,H);J.fromFloat8=J(8,L,L,L);J.toFloat8=J(8,L,L,H);J.fromInt32=J(32,L,H,L);J.toInt32=J(32,L,H,H);J.fromInt16=J(16,L,H,L);J.toInt16=J(16,L,H,H);J.fromInt8=J(8,L,H,L);J.toInt8=J(8,L,H,H);J.fromUint32=J(32,H,H,L);J.toUint32=J(32,H,H,H);J.fromUint16=J(16,H,H,L);J.toUint16=J(16,H,H,H);J.fromUint8=J(8,H,H,L);J.toUint8=J(8,H,H,H);F.Binary=J}(this,k));(function(I,J){function K(L){this.data=L}var H=K.prototype={read:function(M){var L=this,N=L.data.substr(0,M);L.skip(M);return N},skip:function(M){var L=this,N=L.data=L.data.substr(M);L.pointer+=M;return N.length},readBuffer:function(M,P,R){var N=this,Q="read"+R+P,S=P/8,L=M.length,O=0;while(N.data&&O<L){M[O++]=N[Q]()}return O}},G,F;function E(O,M,N){var L=M/8;H["read"+O+M]=function(P){return N(this.read(L),P)}}for(G in J){F=/to([a-z]+)([0-9]+)/i.exec(G);F&&E(F[1],F[2],J[G])}I.Stream=K;K.newType=E}(this,this.Binary));this.PCMData=(function(E,F){function G(H){return(typeof H==="string"?G.decode:G.encode)(H)}G.decodeFrame=function(K,J,H){if(J===8){var I=new (window.Uint8Array||q)(H.length);(new F(K)).readBuffer(I,8,"Uint");for(J=0;J<H.length;J++){H[J]=(I[J]-127.5)*127.5}}else{(new F(K)).readBuffer(H,J,"Float")}return H};G.encodeFrame=function(M,K){var I=E[(K===8?"fromUint":"fromFloat")+K],H=M.length,L="",J;if(K===8){for(J=0;J<H;J++){L+=I(M[J]*127.5+127.5)}}else{for(J=0;J<H;J++){L+=I(M[J])}}return L};G.decode=function(ag,af){var K=new F(ag),Q=K.read(4),Y=K.readUint32();K=new F(K.read(Y));var N=K.read(4),P=K.read(4),W=K.readUint32(),H=new F(K.read(W)),J=H.readUint16(),ab=H.readUint16(),ae=H.readUint32(),L=H.readUint32(),ad=H.readUint16(),ac=ad/ab,O=H.readUint16(),I,S,U,Z,X,M,aa,V={},R={channelCount:ab,bytesPerSample:ad/ab,sampleRate:L/ad,chunks:V,data:X};function T(){I=K.read(4);S=K.readUint32();Z=K.read(S);M=V[I]=V[I]||[];if(I==="data"){U=~~(S/ac);X=R.data=new (typeof d!=="undefined"?d:q)(U);G.decodeFrame(Z,ac*8,X)}else{M.push(Z)}af&&(K.data?setTimeout(T,1):af(R))}if(af){K.data?T():af(R)}else{while(K.data){T()}}return R};G.encode=function(Z,X){var T=E.fromUint32,aa=E.fromUint16,Q=Z.data,H=Z.sampleRate,L=Z.channelCount||1,V=Z.bytesPerSample||1,M=V*8,J=L*V,W=H*J,K=Q.length,I=K*V,P=k.pow(2,M-1)-1,O=[],N="",Y,U,R,S;O.push("fmt "+T(16)+aa(1)+aa(L)+T(H)+T(W)+aa(J)+aa(M));O.push("data"+T(I)+G.encodeFrame(Q,M));S=Z.chunks;if(S){for(U in S){if(S.hasOwnProperty(U)){Y=S[U];for(R=0;R<Y.length;R++){N=Y[R];O.push(U+T(N.length)+N)}}}}O=O.join("");O="RIFF"+T(O.length)+"WAVE"+O;X&&setTimeout(function(){X(O)},1);return O};return G}(this.Binary,this.Stream));(function(F,G){var M=G.sin,Q=G.cos,P=G.sqrt,K=G.floor,L=G.pow,E=G.ln2,J=G.PI,I=J*2;function H(S,R,T){S.sampleRate=R;S.bufferSize=T;S.bandWidth=0.5*T*R*0.5;S.spectrum=new d(T*0.5);S.real=new d(T);S.imag=new d(T);S.peakBand=S.peak=0;S.getBandFrequency=function(U){return this.bandwidth*U+this.bandwidth*0.5};S.calculateSpectrum=function(){var ae=this,aa=ae.spectrum,ab=ae.real,U=ae.imag,ad=0.5*ae.bufferSize,V=P,Z=T*0.5,Y,ac,X,W;for(W=0;W<Z;W++){Y=ab[W];ac=U[W];X=ad*V(Y*Y+ac*ac);if(X>ae.peak){ae.peakBand=W;ae.peak=X}}}}function O(S,R,T){return new O[S](R,T)}function N(S,X){var R=this,V=X*X*0.5,U=new d(V),W=new d(V),T;H(R,S,X);for(T=0;T<V;T++){U[T]=M(T*I/X);W[T]=Q(T*I/X)}R.forward=function(ac){var ah=this,af=ah.real,Y=ah.imag,ae=ah.bufferSize*0.5,aa=ac.length,ad,ag,ab,Z,ai;for(ab=0;ab<ae;ab++){ad=ag=0;for(Z=0;Z<aa;Z++){ad+=W[ai=ab*Z]*ac[Z];ag+=U[ai]*ac[Z]}af[ab]=ad;Y[ab]=ag}return ah.calculateSpectrum()}}F.FourierTransform=O;O.DFT=N}(this,k));e.ADSREnvelope=A;e.MidiEventTracker=D;e.StepSequencer=y;e.AllPassFilter=s;e.Chorus=w;e.Delay=g;e.Distortion=o;e.IIRFilter=f;e.LowPassFilter=a;e.LP12Filter=v;e.Oscillator=c;e.Sampler=b;e.Tracker=z;function n(){}n.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return p.apply(0,[this].concat(q.prototype.splice.call(arguments,0)))}};function p(){var E=q.prototype.splice.call(arguments,0),F=E.prototype=p.prototype;for(i in F){if(F.hasOwnProperty(i)){E[i]=F[i]}}return E}(function(E){p.prototype=E;E.pushSample=function(I){var F=this,H,G;for(G=0;G<F.length;G++){H=F[G].mix;I=F[G].pushSample(I)*H+I*(1-H)}return I}}(new n()));function j(G,F,E){this.channelCount=F;this.effects=[];function H(){G.apply(this,E)}H.prototype=G.prototype;while(F--){this.effects.push(new H())}}j.prototype={mix:0.5,append:function(F){var G=this,I=G.channelCount,E=F.length,H,J;for(H=0;H<E;H+=I){for(J=0;J<I;J++){F[H+J]=G.effects[J].pushSample(F[H+J])*G.mix+F[H+J]*(1-G.mix)}}return F},join:function(){return BufferEffectChain.apply(0,[this].concat(q.prototype.splice.call(arguments,0)))}};function h(){}h.prototype={type:"generator",source:true,mix:1,append:function(F,H){var E=F.length,G,I;for(G=0;G<E;G+=H){this.generate();for(I=0;I<H;I++){F[G+I]=this.getMix(I)*this.mix}}return F}};(function(H,F){function E(I){return new e.BufferEffect(this,I,[].slice.call(arguments,1))}function G(J,K,I){if(K){I=I||K.prototype;G[J]=K;var L=K.prototype=new n();L.name=L.fxid=J;G[J].createBufferBased=E;for(J in I){if(I.hasOwnProperty(J)){L[J]=I[J]}}}return G[J]}e.effects=G;for(F=0;F<H.length;F++){G(H[F],e[H[F]],e[H[F]].prototype)}}(["AllPassFilter","Chorus","Delay","Distortion","IIRFilter","LowPassFilter","LP12Filter"]));(function(G,E){function F(I,J,H){if(J){H=H||J.prototype;F[I]=J;var K=J.prototype=new h();K.name=K.fxid=I;for(I in H){if(H.hasOwnProperty(I)){K[I]=H[I]}}}return F[I]}e.generators=F;for(E=0;E<G.length;E++){F(G[E],e[G[E]],e[G[E]].prototype)}}(["Oscillator","Sampler","Tracker"]));function m(E,F){var G=E[0].toUpperCase()+E.substr(1).toLowerCase();m[E]=F;if(F.decode){e.Sampler.prototype["load"+G]=function(H){this.load.apply(this,[m[E].decode(H)].concat([].slice.call(arguments,1)))}}if(F.encode){e.AudioDevice.Recording.prototype["to"+G]=function(H){return m[E].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:H})}}return F}m("wav",e.PCMData);e.EffectChain=p;e.EffectClass=n;e.BufferEffect=j;e.GeneratorClass=h;e.codecs=e.Codec=m;e.version="0.4.7";return e}).call(typeof exports==="undefined"?{}:this,this.window||global,Math,Object,Array);