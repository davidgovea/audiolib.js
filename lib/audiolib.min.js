this.audioLib=(function AUDIOLIB(a,r,h,H){var m=a.Float32Array||H,g=this;function d(L){var M=new m(L);M.subarray=M.subarray||M.slice;return M}g.Float32Array=d;var n=(function(){if(h.defineProperty){return h.defineProperty}else{if(h.prototype.__defineGetter__){return function(L,N,M){M.get&&L.__defineGetter__(N,M.get);M.set&&L.__defineSetter__(N,M.set)}}}}());function j(N,O,M,L){if(n){n(N,O,{get:function(){return M},enumerable:!!L})}else{N[O]=M}}j(g,"__define",n);j(g,"__defineConst",j);function J(O){var M=arguments,L=M.length,N,P;for(N=1;N<L;N++){for(P in M[N]){if(M[N].hasOwnProperty(P)){O[P]=M[N][P]}}}return O}j(g,"__extend",J);function q(M,O,N){var L;for(L in M){(M.hasOwnProperty(L)||N)&&O.call(M,M[L],L)}return M}j(g,"__enum",q);function A(N,P,O,M,L){this.sampleRate=isNaN(N)?this.sampleRate:N;this.attack=isNaN(P)?this.attack:P;this.decay=isNaN(O)?this.decay:O;this.sustain=isNaN(M)?this.sustain:M;this.release=isNaN(L)?this.release:L}A.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,value:0,state:3,gate:false,generate:function(){this.states[this.state].call(this);return this.value},getMix:function(){return this.value},triggerGate:function(L){this.gate=L;this.state=L?0:3},states:[function(){this.value+=1000/this.sampleRate/this.attack;if(this.value>=1){this.state=1}},function(){this.value-=1000/this.sampleRate/this.decay*this.sustain;if(this.value<=this.sustain){this.state=2}},function(){this.value=this.sustain},function(){this.value=r.max(0,this.value-1000/this.sampleRate/this.release)}]};function G(P,M,O,Q){var N=this,L=0;this.sampleRate=isNaN(P)?this.sampleRate:P;this.stepLength=isNaN(M)?this.stepLength:M;this.steps=O||[1,0];this.attack=isNaN(Q)?this.attack:Q}G.prototype={sampleRate:44100,stepLength:200,steps:null,value:0,attack:0,phase:0,generate:function(){var T=this,O=T.sampleRate/1000*T.stepLength,R=T.steps,P=O*R.length,N,S,L,Q,M;T.phase=(T.phase+1)%P;N=T.phase/P*R.length;S=N%1;N=r.floor(N);L=(N||R.length)-1;Q=R[N]-R[L];M=R[N];if(S<T.attack){M-=Q-Q/T.attack*S}T.value=M;return M},getMix:function(){return this.value},triggerGate:function(){this.phase=0}};function k(L,M){this.sampleRate=isNaN(L)?this.sampleRate:L;this.schedule=[];this.reset(M)}k.prototype={sampleRate:44100,value:1,schedule:null,clock:0,getMix:function(){return this.value},generate:function(){var L;for(L=0;L<this.schedule.length;L++){if(this.schedule[L].t--){this.value=this.schedule[L].v;this.schedule.splice(L--,1)}}},setValue:function(L){this.schedule.push({v:L,t:~~((+new Date-this.clock)/1000*this.sampleRate)})},reset:function(L){this.value=isNaN(L)?this.value:L;this.clock=+new Date}};function I(O,Q,L){var M=this,P=0,N=0;M.sampleRate=O;M.buffer=new d(isNaN(Q)?500:Q);M.bufferSize=M.buffer.length;M.feedback=isNaN(L)?0.5:L;M.pushSample=function(S){var R=M.buffer[N];P=-S+R;M.buffer[N++]=S+R*M.feedback;if(N>=M.bufferSize){N=0}return P};M.getMix=function(){return P};M.reset=function(){N=0;P=0;M.buffer=new d(M.bufferSize)}}function B(R,P,M,L,Q,O){var N=this,S=0;N.inputs=[0,0];N.outputs=[0,0];N.sampleRate=R;N.coefs={a0:P,a1:M,a2:L,b1:Q,b2:O};N.pushSample=function(U){var W=N.coefs,T=N.inputs,V=N.outputs;S=W.a0*U+W.a1*T[0]+W.a2*T[1]-W.b1*V[0]-W.b2*V[1];T.pop();T.unshift(U);V.pop();V.unshift(S);return S};N.getMix=function(){return S};N.reset=function(){N.inputs=[0,0];N.outputs=[0,0]}}B.LowPass=function(X,P,S){var T=2*r.PI*P/X,Y=r.cos(T),L=r.sin(T),R=L/(2*S),W=(1-Y)/2,V=1-Y,U=W,O=1+R,N=-2*Y,M=1-R;return new B(X,W/O,V/O,U/O,N/O,M/O)};B.HighPass=function(X,P,S){var T=2*r.PI*P/X,Y=r.cos(T),L=r.sin(T),R=L/(2*S),W=(1+Y)/2,V=-(1+Y),U=W,O=1+R,N=-2*Y,M=1-R;return new g.BiquadFilter(X,W/O,V/O,U/O,N/O,M/O)};B.AllPass=function(X,R,S){var T=2*r.PI*R/X,Y=r.cos(T),L=r.sin(T),P=L/(2*S),W=1-P,V=-2*Y,U=1+P,O=U,N=V,M=W;return new g.BiquadFilter(X,W/O,V/O,U/O,N/O,M/O)};B.BandPass=function(X,N,T){var S=2*r.PI*N/X,Y=r.cos(S),L=r.sin(S),Q=r.log(2)/2*T*S/L,R=L*(r.exp(Q)-r.exp(-Q))/2,W=R,V=0,U=-R,P=1+R,O=-2*Y,M=1-R;return new g.BiquadFilter(X,W/P,V/P,U/P,O/P,M/P)};function s(M,O){var L=this,N=0;L.sampleRate=M;L.resolution=O?r.pow(2,O-1):r.pow(2,8-1);L.pushSample=function(P){N=r.floor(P*L.resolution+0.5)/L.resolution;return N};L.getMix=function(){return N}}function b(S,P,O,L){var T=this,N,M,R;T.delayTime=P||30;T.depth=O||3;T.freq=L||0.1;function Q(){N=new d(T.sampleRate*0.1);M=0;var V,U=N.length;for(V=0;V<U;V++){N[V]=0}}T.sampleRate=S;T.osc=new v(S,L);T.calcCoeff=Q;T.pushSample=function(V){if(++M>=N.length){M=0}N[M]=V;T.osc.generate();var U=T.delayTime+T.osc.getMix()*T.depth;U*=T.sampleRate/1000;U=M-r.floor(U);while(U<0){U+=N.length}R=N[U];return R};T.getMix=function(){return R};Q()}function c(Q,R,L,P){var N=this,S=0,O=0,M=0;N.sampleRate=Q;N.buffer=new d(isNaN(R)?1200:R);N.bufferSize=N.buffer.length;N.feedback=isNaN(L)?0.84:L;N.damping=isNaN(P)?0.2:P;N.pushSample=function(T){S=N.buffer[O];M=S*(1-N.damping)+M*N.damping;N.buffer[O++]=T+M*N.feedback;if(O>=N.bufferSize){O=0}return S};N.getMix=function(){return S};N.reset=function(){O=0;M=0;S=0;N.buffer=new d(N.bufferSize)}}function z(N,M,P){var L=this,O=0;L.sampleRate=N;L.scale=M||1;L.gain=P||0.5;L.pushSample=function(Q){Q/=L.scale;O=(1+L.gain)*Q-L.gain*Q*Q*Q;return O};L.getMix=function(){return O}}function o(N,O,L){var M=this;M.time=isNaN(O)?M.time:O;M.feedback=isNaN(L)?M.feedback:L;M.reset(N)}o.prototype={sampleRate:1,bufferPos:0,buffer:null,time:1000,feedback:0,sample:0,_rstf:1,pushSample:function(N){var M=this,L=M.buffer;L[M.bufferPos++]+=N;if(M.bufferPos>M.time*M._rstf){M.bufferPos=0}M.sample=L[M.bufferPos];L[M.bufferPos]*=M.feedback;return M.sample},getMix:function(){return this.sample},resample:function(N){var L=this,M=L.time/N;L.buffer=g.Sampler.resample(L.buffer,N);L.time=N;L.bufferPos=r.round(M*L.bufferPos);return L.buffer},reset:function(N,Q){var L=this,M=L.buffer,O,P;N=isNaN(N)?L.sampleRate:N;P=L.sampleRate/N;L.buffer=new d(N*o.MAX_DELAY);L.bufferPos=r.round(P*L.bufferPos);L._rstf=1/1000*N;if(Q){M=g.Sampler.resample(M,P);for(O=0;O<M.length&&O<L.buffer.length;O++){L.buffer[O]=M[O]}}return L.buffer}};o.MAX_DELAY=2;function l(L){var P=new e(L,720.484),O=new e(L,723.431),N=new e(L,1),M=0;this.gain=4;this.master=1;this.sampleRate=L;this.filters=[P,O,N];this.pushSample=function(Q){P.pushSample(Q);M=P.getMix(1)*this.gain;M=r.atan(M)+M;if(M>0.4){M=0.4}else{if(M<-0.4){M=-0.4}}O.pushSample(M);N.pushSample(O.getMix(0));M=N.getMix(1)*this.master;return M};this.getMix=function(){return M}}function D(M,O,P){var L=this,N=0;L.sampleRate=M;L.tuning=P||D.tuning;L.spread=O?L.tuning.stereospread:0;L.gain=L.tuning.fixedgain;L.wet=0.5;L.dry=0.6;L.CFs=(function(W){var T=[],R=W.numcombs,Q=W.initialdamp*W.scaledamp,V=W.initial,U=W.combs,S;for(S=0;S<R;S++){T.push(new g.CombFilter(L.sampleRate,U[S]+L.spread,V,Q))}return T}(L.tuning));L.numCFs=L.CFs.length;L.APFs=(function(V){var U=[],Q=V.numallpasses,T=0.5,S=V.allpasses,R;for(R=0;R<Q;R++){U.push(new D.AllPassFilter(L.sampleRate,S[R]+L.spread,T))}return U}(L.tuning));L.numAPFs=L.APFs.length;L.pushSample=function(T){var R=T*L.gain,Q=0,S;for(S=0;S<L.numCFs;S++){Q+=L.CFs[S].pushSample(R)}for(S=0;S<L.numAPFs;S++){Q=L.APFs[S].pushSample(Q)}N=Q*L.wet+T*L.dry;return N};L.getMix=function(){return N};L.reset=function(){}}D.tuning={numcombs:8,combs:[1116,1188,1277,1356,1422,1491,1557,1617],numallpasses:4,allpasses:[556,441,341,225],fixedgain:0.015,scalewet:3,scaledry:2,scaledamp:0.4,scaleroom:0.28,offsetroom:0.7,initialroom:0.5,initialdamp:0.5,initialwet:1/3,initialdry:0,initialwidth:1,initialmode:0,freezemode:0.5,stereospread:23};D.AllPassFilter=function(O,Q,L){var M=this,P=0,N=0;M.sampleRate=O;M.buffer=new d(isNaN(Q)?500:Q);M.bufferSize=M.buffer.length;M.feedback=isNaN(L)?0.5:L;M.pushSample=function(S){var R=M.buffer[N];P=-S+R;M.buffer[N++]=S+R*M.feedback;if(N>=M.bufferSize){N=0}return P};M.getMix=function(){return P};M.reset=function(){N=0;P=0;M.buffer=new d(M.bufferSize)}};function x(L,M){this.sampleRate=isNaN(L)?this.sampleRate:L;this.gain=isNaN(M)?this.gain:M}x.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(L){this.sample=L*this.gain;return this.sample},getMix:function(){return this.sample}};function e(Q,M,X,V){var Y=this,S=[0,0,0,0],L,O,W,N,U=r.sin,P=r.min,R=r.pow;Y.cutoff=!M?20000:M;Y.resonance=!X?0.1:X;Y.samplerate=Q;Y.type=V||0;function T(){L=2*U(r.PI*P(0.25,Y.cutoff/(Y.samplerate*2)));O=P(2*(1-R(Y.resonance,0.25)),P(2,2/L-L*0.5))}Y.pushSample=function(Z){if(W!==Y.cutoff||N!==Y.resonance){T();W=Y.cutoff;N=Y.resonance}S[3]=Z-O*S[2];S[0]=S[0]+L*S[2];S[1]=S[3]-S[0];S[2]=L*S[1]+S[2];S[3]=Z-O*S[2];S[0]=S[0]+L*S[2];S[1]=S[3]-S[0];S[2]=L*S[1]+S[2];return S[Y.type]};Y.getMix=function(Z){return S[Z||Y.type]}}function K(Q,N,X){var Y=this,V=0,P=0,S=r.PI*2,U,M,L,T,W,O;Y.cutoff=!N?20000:N;Y.resonance=!X?1:X;Y.samplerate=Q;function R(){U=S*Y.cutoff/Y.samplerate;M=1-U/(2*(Y.resonance+0.5/(1+U))+U-2);L=M*M;T=L+1-2*r.cos(U)*M}Y.pushSample=function(Z){if(W!==Y.cutoff||O!==Y.resonance){R();W=Y.cutoff;O=Y.resonance}V+=(Z-P)*T;P+=V;V*=L;return P};Y.getMix=function(){return P};R()}function v(M,N){var L=this;L.frequency=isNaN(N)?440:N;L.waveTable=new d(1);L.sampleRate=M;L.waveShapes=L.waveShapes.slice(0)}(function(N,O,M,L){M=v.prototype={sampleRate:1,frequency:440,phase:0,phaseOffset:0,pulseWidth:0.5,fm:0,waveShape:"sine",_p:0,generate:function(){var P=this,R=+P.frequency,Q=P.pulseWidth,S=P.phase;R+=R*P.fm;P.phase=(S+R/P.sampleRate/2)%1;S=(P.phase+P.phaseOffset)%1;P._p=S<Q?S/Q:(S-Q)/(1-Q)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(P){this.phase=this._p=isNaN(P)?0:P},setWavetable:function(P){this.waveTable=P;return true},sine:function(){return r.sin(this._p*N)},triangle:function(){return this._p<0.5?4*this._p-1:3-4*this._p},square:function(){return this._p<0.5?-1:1},sawtooth:function(){return 1-this._p*2},invSawtooth:function(){return this._p*2-1},pulse:function(){return this._p<0.5?this._p<0.25?this._p*8-1:1-(this._p-0.25)*8:-1},wavetable:function(){return g.Sampler.interpolate(this.wavetable,this._p*this.wavetable.length)},waveShapes:[]};for(L=0;L<O.length;L++){M[L]=M[O[L]];M.waveShapes.push(M[L])}v.WaveShape=function(Q,P){if(P){this.prototype[Q]=P}return this.prototype[Q]};v.createMixWave=function(Q,T){var P=T.length,S,R;return this.WaveShape(Q,function(){S=0;for(R=0;R<P;R++){S+=this[T[R].shape]()*T[R].mix}return S})}}(r.PI*2,["sine","triangle","pulse","sawtooth","invSawtooth","square"]));function C(M,N){var L=this;L.voices=[];L.sampleRate=M;L.pitch=isNaN(N)?440:L.pitch}C.prototype={sampleRate:1,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(R,P){R=isNaN(R)?this.pitch:R;var M=this,Q=R/M.pitch,O=M.sampleRate,S=O*M.delayStart,L=M.sampleSize-O*M.delayEnd-1,N={f:R,p:S,s:Q,l:L,v:isNaN(P)?1:P};M.voices.push(N);while(M.voices.length>M.maxVoices){L=M.voices.shift();L.onend&&L.onend()}return N},generate:function(){var L=this.voices,M,N;for(M=0;M<L.length;M++){N=L[M];N.p+=N.s;N.p>N.l&&L.splice(M--,1)&&N.onend&&N.onend()}},getMix:function(O){var L=this.voices,N=0,M;O=O||0;if(this.samples[O]){for(M=0;M<L.length;M++){N+=C.interpolate(this.samples[O],L[M].p)*L[M].v}}return N},load:function(P,O){var L=this,M=L.samples=C.deinterleave(P.data,P.channelCount),N;if(O){for(N=0;N<M.length;N++){M[N]=C.resample(M[N],P.sampleRate,L.sampleRate)}}L.sample=P.data;L.samples=M;L.data=P;L.sampleSize=M[0].length}};(function(){function L(M,N){if(M&&N){L[M]=N}else{if(M&&L[M] instanceof Function){C.interpolate=L[M]}}return L[M]}C.interpolation=L;L("linear",function(M,Q){var P=r.floor(Q),O=P+1,N=Q-P;O=O<M.length?O:0;return M[P]*(1-N)+M[O]*N});L("nearest",function(M,N){return N>=M.length-0.5?M[0]:M[r.round(N)]});L("linear")}());C.resample=function(S,L,V,W,N){var R=arguments.length,P=R===2?L:R===3?L/V:W/L*N/V,Q=S.length,M=r.ceil(Q/P);console.log("argc:"+R+" l:"+Q+" speed:"+P+" length:"+M);console.log(arguments);var U=new d(M),T,O;for(T=0,O=0;T<Q;T+=P){U[O++]=C.interpolate(S,T)}return U};C.deinterleave=function(M,Q){var L=M.length,P=L/Q,N=[],O,R;for(O=0;O<Q;O++){N[O]=new d(P);for(R=0;R<P;R++){N[O][R]=M[R*Q+O]}}return N};C.interleave=function(N){var P=N.length,M=N[0].length,L=new d(M*P),O,Q;for(O=0;O<P;O++){for(Q=0;Q<M;Q++){L[O+Q*P]=N[O][Q]}}return L};C.mix=function(N){var M=[].slice.call(arguments,1),L,O,P;for(P=0;P<M.length;P++){L=r.max(N.length,M[P].length);for(O=0;O<L;O++){N[O]+=M[P][O]}}return N};function w(N,O,M){var L=this;L.notes=[];L.sampleRate=N;L.noteTime=isNaN(O)?250:O;L.noteLength=N*0.001*L.noteTime;L.zero=new d(L.noteLength);L.cb=M}w.prototype={pos:0,looping:false,generate:function(){var L=this,N,M;if((L.pos+=1)===L.noteLength){N=L.notes,M=N.shift();if(L.looping){N.push(M)}L.pos=0;L.cb()}},getMix:function(){var L=this,M=L.notes[0]||L.zero;return M[L.pos]},addNote:function(M){var L=this,P=L.noteLength,O=new d(P),N=0;for(N=0;N<P;N++){O[N]=M(N)}L.notes.push(O)},addBuffer:function(L){this.notes.push(L)},getNoteLength:function(){return this.noteLength},getNoteCount:function(){return this.notes.length-1},setLooping:function(L){this.looping=(typeof L==="undefined")?true:L},reset:function(){this.notes=[];this.pos=0}};(function(L){function Q(X){var Z,Y=X.length,W={};for(Z=0;Z<Y;Z++){W[X[Z]]=true}return W}var T=Q([256,512,1024,2048,4096,8192,16384]),M=Q([48000,44100,22050]),V=String.fromCharCode;function U(ab,aa,Z,Y){var X=U.devices,W;for(W in X){if(X.hasOwnProperty(W)&&X[W].enabled){try{return new X[W](ab,aa,Z,Y)}catch(ac){}}}throw"No audio device available."}function N(W){this.boundTo=W;this.buffers=[];W.activeRecordings.push(this)}N.prototype={add:function(W){this.buffers.push(W)},clear:function(){this.buffers=[]},stop:function(){var W=this.boundTo.activeRecordings,X;for(X=0;X<W.length;X++){if(W[X]===this){W.splice(X--,1)}}},join:function(){var aa=0,ab=0,Y=this.buffers,W,ac,Z,X=Y.length;for(Z=0;Z<X;Z++){aa+=Y[Z].length}W=new d(aa);for(Z=0;Z<X;Z++){for(ac=0;ac<Y[Z].length;ac++){W[ab+ac]=Y[Z][ac]}ab+=Y[Z].length}return W}};function S(W){this.type=W}S.prototype={record:function(){return new N(this)},recordData:function(X){var Z=this.activeRecordings,Y,W=Z.length;for(Y=0;Y<W;Y++){Z[Y].add(X)}},writeBuffers:function(Y){var X=this.buffers,W=Y.length,Z,ab,aa,ac;if(X){for(aa=0;aa<X.length;aa++){Z=X[aa];ab=Z.length;for(ac=0;ac<W&&ac<ab;ac++){Y[ac]+=Z[ac]}X[aa]=Z.subarray(ac);aa>=ab&&X.splice(aa--,1)}}},writeBuffer:function(X){var W=this.buffers=this.buffers||[];W.push(X);return W.length}};function R(ag,ad,X,ai){ai=M[ai]?ai:44100;X=T[X]?X:ai/2;var ak=this,Z=0,ah=null,af=new Audio(),ae,ac,ab,aa,W;function aj(aq,am){var ap,ao,al;if(R.backgroundWork){if(window.MozBlobBuilder){al=new MozBlobBuilder();al.append('setInterval(function(){ postMessage("tic"); }, '+am+");");ao=window.URL.createObjectURL(al.getBlob());ap=new Worker(ao);ap.onmessage=function(){aq()};return function(){ap.terminate();window.URL.revokeObjectURL(ao)}}ao=al=+new Date+"";function an(ar){if(ar.source===window&&ar.data===ao&&al<+new Date){al=+new Date+am;aq()}window.postMessage(ao,"*")}window.addEventListener("message",an,true);window.postMessage(ao,"*");return function(){window.removeEventListener("message",an)}}else{ap=setInterval(aq,am);return function(){clearInterval(ap)}}}function Y(){if(ah){ae=af.mozWriteAudio(ah);Z+=ae;if(ae<ah.length){ah=ah.subarray(ae);return ah}ah=null}ac=af.mozCurrentSampleOffset();ab=Number(ac+X*ad-Z)+0;if(ab>0){aa=new d(ab);ag&&ag(aa,ak.channelCount);ak.writeBuffers(aa);ak.recordData(aa);ae=af.mozWriteAudio(aa);if(ae<aa.length){ah=aa.subarray(ae)}Z+=ae}}af.mozSetup(ad,ai);W=aj(Y,20);this.kill=function(){W()};this.activeRecordings=[];this.sampleRate=ai;this.channelCount=ad;this.type="moz"}R.enabled=true;R.backgroundWork=false;R.prototype=new S("moz");function P(ad,ab,Z,Y){Y=M[Y]?Y:44100;Z=T[Z]?Z:4096;var W=this,aa=new (window.AudioContext||webkitAudioContext)(),ac=aa.createJavaScriptNode(Z,0,ab);function X(al){var ae=al.outputBuffer,ah=ae.numberOfChannels,aj,ag,ai=ae.length,am=ae.size,ak=new H(ah),af=new d(ai*ah);for(aj=0;aj<ah;aj++){ak[aj]=ae.getChannelData(aj)}ad&&ad(af,ah);W.writeBuffers(af);W.recordData(af);for(aj=0;aj<ai;aj++){for(ag=0;ag<ah;ag++){ak[ag][aj]=af[aj*ah+ag]}}}ac.onaudioprocess=X;ac.connect(aa.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=aa.sampleRate;this.channelCount=ab;this._context=aa;this._node=ac;this._callback=X;this.type="webkit"}P.enabled=true;P.prototype=new S("webkit");function O(ab,aa,Z,Y){Y=M[Y]?Y:44100;Z=T[Z]?bufferSize:8192;var W=this,ac;function X(){var ad=new d(Z*aa);ab&&ab(ad,W.channelCount);W.writeBuffers(ad);W.recordData(ad)}this.kill=function(){clearInterval(ac)};this.activeRecordings=[];setInterval(X,Z/Y*1000);this.sampleRate=Y;this.channelCount=aa;this.type="dummy"}O.enabled=true;O.prototype=new S("dummy");U.deviceClass=S;U.propertyEnum=Q;U.devices={moz:R,webkit:P,dummy:O};U.Recording=N;L.AudioDevice=U}(this));this.AudioDevice.createScheduled=function(P){var O=[],L=0,M;function N(R,U){var Q=R.length/U,X=M.chunkSize,T=X*U,W,S,V;L=+new Date;for(S=0;S<Q;S+=X){for(W=0;W<O.length;W++){O[W].t-=X;if(O[W].t<=0){O[W].f.apply(O[W].x,O[W].a);O.splice(W--,1)}}V=S*T;P(R.subarray(V,V+T),U)}}M=this.apply(this,[N].concat(H.prototype.splice.call(arguments,1)));M.schedule=function(S,R,Q){O.push({f:S,x:R,a:Q,t:((new Date-L)*0.001*this.sampleRate)})};M.chunkSize=1;return M};(function(){function L(){var N=arguments,M=N.length,P,O;for(O=0;O<M;O++){P=N[O];this.postMessage({type:"injection",code:P instanceof Function?"("+String(P)+").call(this);":P})}}g.AudioWorker=function(O,Q){var M=new (window.MozBlobBuilder||window.BlobBuilder)(),N,P;M.append("var audioLib = ("+String(AUDIOLIB)+"(this, Math, Object, Array));\n");for(N=0;N<g.plugins._pluginList.length;N++){M.append("("+String(g.plugins._pluginList[N])+"());\n")}Q&&M.append('this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)}, true);\n');M.append(O instanceof Function?"("+String(O)+").call(this);":O);N=window.URL.createObjectURL(M.getBlob());P=new Worker(N);P._terminate=P.terminate;P.terminate=function(){window.URL.revokeObjectURL(id);return P._terminate.call(P,arguments)};if(Q){P.inject=L}return P}}());(function(M,N){var U=String.fromCharCode,S=true,O=false;function P(V,W){return W?U(V&255)+P(V>>8,W-1):""}function R(V,W){return W?R(V>>8,W-1)+U(255-V&255):""}function T(V,W,X){return X?R(V,W):P(V,W)}function L(aa,Z){var V=aa.length,Y=V-1,ab=0,X=N.pow,W;if(Z){for(W=0;W<V;W++){ab+=(255-aa.charCodeAt(W))*X(256,Y-W)}}else{for(W=0;W<V;W++){ab+=aa.charCodeAt(W)*X(256,W)}}return ab}function Q(Z,ae,Y,ah){var ad=N.pow,ac=N.floor,W=Q.convertFromBinary,af=Q.convertToBinary,V=Z/8,ab=ad(2,Z),ag=ab/2,ai=ag-1,aa=1/ag,X=1/ai;return ah?Y?ae?function(aj,ak){aj=ac(aj<0?aj*ag+ab:aj*ai);return af(aj,V,ak)}:function(aj,ak){return af(ac(aj*ai),V,ak)}:ae?function(aj,ak){return af(aj<0?aj+ab:aj,V,ak)}:function(aj,ak){return af(aj,V,ak)}:Y?ae?function(al,ak){var aj=W(al,ak);return aj>ai?(aj-ab)*aa:aj*X}:function(ak,aj){return W(ak,aj)*X}:ae?function(al,ak){var aj=W(al,ak);return aj>ai?aj-ab:aj}:function(ak,aj){return W(ak,aj)}}Q.convertToBinary=T;Q.convertFromBinary=L;Q.fromFloat32=Q(32,S,S,S);Q.toFloat32=Q(32,S,S,O);Q.fromFloat24=Q(24,S,S,S);Q.toFloat24=Q(24,S,S,O);Q.fromFloat16=Q(16,S,S,S);Q.toFloat16=Q(16,S,S,O);Q.fromFloat8=Q(8,S,S,S);Q.toFloat8=Q(8,S,S,O);Q.fromInt32=Q(32,S,O,S);Q.toInt32=Q(32,S,O,O);Q.fromInt16=Q(16,S,O,S);Q.toInt16=Q(16,S,O,O);Q.fromInt8=Q(8,S,O,S);Q.toInt8=Q(8,S,O,O);Q.fromUint32=Q(32,O,O,S);Q.toUint32=Q(32,O,O,O);Q.fromUint16=Q(16,O,O,S);Q.toUint16=Q(16,O,O,O);Q.fromUint8=Q(8,O,O,S);Q.toUint8=Q(8,O,O,O);M.Binary=Q}(this,r));(function(P,Q){function R(S){this.data=S}var O=R.prototype={read:function(T){var S=this,U=S.data.substr(0,T);S.skip(T);return U},skip:function(T){var S=this,U=S.data=S.data.substr(T);S.pointer+=T;return U.length},readBuffer:function(T,W,Y){var U=this,X="read"+Y+W,Z=W/8,S=T.length,V=0;while(U.data&&V<S){T[V++]=U[X]()}return V}},N,M;function L(V,T,U){var S=T/8;O["read"+V+T]=function(W){return U(this.read(S),W)}}for(N in Q){M=/to([a-z]+)([0-9]+)/i.exec(N);M&&L(M[1],M[2],Q[N])}P.Stream=R;R.newType=L}(this,this.Binary));this.PCMData=(function(L,M){function N(O){return(typeof O==="string"?N.decode:N.encode)(O)}N.decodeFrame=function(R,Q,O){if(Q===8){var P=new (window.Uint8Array||H)(O.length);(new M(R)).readBuffer(P,8,"Uint");for(Q=0;Q<O.length;Q++){O[Q]=(P[Q]-127.5)*127.5}}else{(new M(R)).readBuffer(O,Q,"Float")}return O};N.encodeFrame=function(T,R){var P=L[(R===8?"fromUint":"fromFloat")+R],O=T.length,S="",Q;if(R===8){for(Q=0;Q<O;Q++){S+=P(T[Q]*127.5+127.5)}}else{for(Q=0;Q<O;Q++){S+=P(T[Q])}}return S};N.decode=function(an,am){var R=new M(an),X=R.read(4),af=R.readUint32();R=new M(R.read(af));var U=R.read(4),W=R.read(4),ad=R.readUint32(),O=new M(R.read(ad)),Q=O.readUint16(),ai=O.readUint16(),al=O.readUint32(),S=O.readUint32(),ak=O.readUint16(),aj=ak/ai,V=O.readUint16(),P,Z,ab,ag,ae,T,ah,ac={},Y={channelCount:ai,bytesPerSample:ak/ai,sampleRate:S/ak,chunks:ac,data:ae};console.log("channels "+ai);function aa(){P=R.read(4);Z=R.readUint32();ag=R.read(Z);T=ac[P]=ac[P]||[];if(P==="data"){ab=~~(Z/aj);ae=Y.data=new (typeof d!=="undefined"?d:H)(ab);N.decodeFrame(ag,aj*8,ae)}else{T.push(ag)}am&&(R.data?setTimeout(aa,1):am(Y))}if(am){R.data?aa():am(Y)}else{while(R.data){aa()}}return Y};N.encode=function(ag,ae){var aa=L.fromUint32,ah=L.fromUint16,X=ag.data,O=ag.sampleRate,S=ag.channelCount||1,ac=ag.bytesPerSample||1,T=ac*8,Q=S*ac,ad=O*Q,R=X.length,P=R*ac,W=r.pow(2,T-1)-1,V=[],U="",af,ab,Y,Z;V.push("fmt "+aa(16)+ah(1)+ah(S)+aa(O)+aa(ad)+ah(Q)+ah(T));V.push("data"+aa(P)+N.encodeFrame(X,T));Z=ag.chunks;if(Z){for(ab in Z){if(Z.hasOwnProperty(ab)){af=Z[ab];for(Y=0;Y<af.length;Y++){U=af[Y];V.push(ab+aa(U.length)+U)}}}}V=V.join("");V="RIFF"+aa(V.length)+"WAVE"+V;ae&&setTimeout(function(){ae(V)},1);return V};return N}(this.Binary,this.Stream));(function(M,N){var T=N.sin,X=N.cos,W=N.sqrt,R=N.floor,S=N.pow,L=N.ln2,Q=N.PI,P=Q*2;function O(Z,Y,aa){Z.sampleRate=Y;Z.bufferSize=aa;Z.bandWidth=0.5*aa*Y*0.5;Z.spectrum=new d(aa*0.5);Z.real=new d(aa);Z.imag=new d(aa);Z.peakBand=Z.peak=0;Z.getBandFrequency=function(ab){return this.bandwidth*ab+this.bandwidth*0.5};Z.calculateSpectrum=function(){var al=this,ah=al.spectrum,ai=al.real,ab=al.imag,ak=0.5*al.bufferSize,ac=W,ag=aa*0.5,af,aj,ae,ad;for(ad=0;ad<ag;ad++){af=ai[ad];aj=ab[ad];ae=ak*ac(af*af+aj*aj);if(ae>al.peak){al.peakBand=ad;al.peak=ae}}}}function V(Z,Y,aa){return new V[Z](Y,aa)}function U(Z,ae){var Y=this,ac=ae*ae*0.5,ab=new d(ac),ad=new d(ac),aa;O(Y,Z,ae);for(aa=0;aa<ac;aa++){ab[aa]=T(aa*P/ae);ad[aa]=X(aa*P/ae)}Y.forward=function(aj){var ao=this,am=ao.real,af=ao.imag,al=ao.bufferSize*0.5,ah=aj.length,ak,an,ai,ag,ap;for(ai=0;ai<al;ai++){ak=an=0;for(ag=0;ag<ah;ag++){ak+=ad[ap=ai*ag]*aj[ag];an+=ab[ap]*aj[ag]}am[ai]=ak;af[ai]=an}return ao.calculateSpectrum()}}M.FourierTransform=V;V.DFT=U}(this,r));g.ADSREnvelope=A;g.StepSequencer=G;g.UIControl=k;g.BiquadFilter=B;g.BitCrusher=s;g.Chorus=b;g.CombFilter=c;g.Compressor=z;g.Delay=o;g.Distortion=l;g.GainController=x;g.IIRFilter=e;g.LP12Filter=K;g.Oscillator=v;g.Sampler=C;function F(){}F.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return t.apply(0,[this].concat(H.prototype.splice.call(arguments,0)))},addPreProcessing:function(L){L.pushSample=this.pushSample;this.pushSample=function(){L.apply(this,arguments);return L.pushSample.apply(this,arguments)}},removePreProcessing:function(M){var L;while(L=this.pushSample.pushSample){if(L===M||!M){this.pushSample=L;M.pushSample=null}}}};function t(){var L=H.prototype.splice.call(arguments,0),M=L.prototype=t.prototype;for(i in M){if(M.hasOwnProperty(i)){L[i]=M[i]}}return L}(function(L){t.prototype=L;L.pushSample=function(P){var M=this,O,N;for(N=0;N<M.length;N++){O=M[N].mix;P=M[N].pushSample(P)*O+P*(1-O)}return P}}(new F()));function E(N,M,L){this.channelCount=M;this.effects=[];function O(){N.apply(this,L)}O.prototype=N.prototype;while(M--){this.effects.push(new O())}}E.prototype={mix:0.5,append:function(M){var N=this,P=N.channelCount,L=M.length,O,Q;for(O=0;O<L;O+=P){for(Q=0;Q<P;Q++){M[O+Q]=N.effects[Q].pushSample(M[O+Q])*N.mix+M[O+Q]*(1-N.mix)}}return M},join:function(){return BufferEffectChain.apply(0,[this].concat(H.prototype.splice.call(arguments,0)))},addPreProcessing:function(){var L;for(L=0;L<this.effects.length;L++){this.effects[L].addPreProcessing.apply(this.effects[L],arguments)}},removePreProcessing:function(){var L;for(L=0;L<this.effects.length;L++){this.effects[L].removePreProcessing.apply(this.effects[L],arguments)}},addAutomation:function(){return g.Automation.apply(g,[this].concat([].slice.call(arguments)))}};function f(){}f.prototype={type:"generator",source:true,mix:1,generatedBuffer:null,append:function(M,O){var L=M.length,N,P;O=O||1;for(N=0;N<L;N+=O){this.generate();for(P=0;P<O;P++){M[N+P]=this.getMix(P)*this.mix+M[N+P]}}return M},addPreProcessing:function(L){L.generate=this.generate;this.generate=function(){L.apply(this,arguments);return L.generate.apply(this,arguments)}},removePreProcessing:function(M){var L;while(L=this.generate.generate){if(L===M||!M){this.generate=L;M.generate=null}}},addAutomation:function(){return g.Automation.apply(g,[this].concat([].slice.call(arguments)))},generateBuffer:function(M){this.generatedBuffer=new d(M);var L;for(L=0;L<M;L++){this.generate();this.generatedBuffer[L]=this.getMix()}}};(function(O,M){function L(P){return new g.BufferEffect(this,P,[].slice.call(arguments,1))}function N(Q,R,P){if(R){P=P||R.prototype;N[Q]=R;var S=R.prototype=new F();S.name=S.fxid=Q;N[Q].createBufferBased=L;for(Q in P){if(P.hasOwnProperty(Q)){S[Q]=P[Q]}}}return N[Q]}g.effects=N;for(M=0;M<O.length;M++){N(O[M],g[O[M]],g[O[M]].prototype)}}(["BiquadFilter","BitCrusher","Chorus","CombFilter","Compressor","Delay","Distortion","GainController","IIRFilter","LP12Filter"]));(function(N,L){function M(P,Q,O){if(Q){O=O||Q.prototype;M[P]=Q;var R=Q.prototype=new f();R.name=R.fxid=P;for(P in O){if(O.hasOwnProperty(P)){R[P]=O[P]}}}return M[P]}g.generators=M;for(L=0;L<N.length;L++){M(N[L],g[N[L]],g[N[L]].prototype)}}(["Oscillator","Sampler","ADSREnvelope","StepSequencer","UIControl"]));function y(L,M){var N=L[0].toUpperCase()+L.substr(1).toLowerCase();y[L]=M;if(M.decode){g.Sampler.prototype["load"+N]=function(O){this.load.apply(this,[y[L].decode(O)].concat([].slice.call(arguments,1)))}}if(M.encode){g.AudioDevice.Recording.prototype["to"+N]=function(O){return y[L].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:O})}}return M}y("wav",g.PCMData);function p(L,M){p[L]=M;p._pluginList.push({plugin:M,name:L})}j(p,"_pluginList",[],false);function u(O,P,L,M,N){if(!O.automation){O.automation=[];if(O.type==="generator"){O.append=u.generatorAppend}else{O.append=u.effectAppend}}var L={parameter:P,automation:L,amount:isNaN(M)?1:M,type:N||"modulation"};O.automation.push(L);return L}u.generatorAppend=function(R,O){var U=this,P=R.length,Q=U.automation.length,L=[],S,M,N,T;O=O||1;for(N=0;N<Q;N++){L.push(U[U.automation[N].parameter])}for(S=0;S<P;S+=O){for(N=0;N<Q;N++){U[U.automation[N].parameter]=L[N]}for(N=0;N<Q;N++){T=U.automation[N];switch(T.type){case"modulation":U[T.parameter]*=T.amount*T.automation.generatedBuffer[S];break;case"addition":U[T.parameter]+=T.amount*T.automation.generatedBuffer[S];break;case"substraction":U[T.parameter]-=T.amount*T.automation.generatedBuffer[S];break;case"additiveModulation":U[T.parameter]+=U[T.parameter]*T.amount*T.automation.generatedBuffer[S];break;case"substractiveModulation":U[T.parameter]-=U[T.parameter]*T.amount*T.automation.generatedBuffer[S];break;case"assignment":U[T.parameter]=T.amount*T.automation.generatedBuffer[S];break;case"absoluteAssignment":U[T.parameter]=r.abs(T.amount*T.automation.generatedBuffer[S]);break}}U.generate();for(M=0;M<O;M++){R[S+M]=U.getMix(M)*U.mix+R[S+M]}}for(N=0;N<Q;N++){U[U.automation[N].parameter]=L[N]}return R};u.effectAppend=function(R){var V=this,L=V.channelCount,P=R.length,Q=V.automation.length,M=[],S,N,O,T,U;for(O=0;O<Q;O++){M.push([]);for(N=0;N<L;N++){M[O].push(V.effects[N][V.automation[O].parameter])}}for(S=0;S<P;S+=L){for(N=0;N<L;N++){for(O=0;O<Q;O++){U=V.automation[O];V.effects[N][U.parameter]=M[O][N];switch(U.type){case"modulation":V.effects[N][U.parameter]*=U.amount*U.automation.generatedBuffer[S];break;case"addition":V.effects[N][U.parameter]+=U.amount*U.automation.generatedBuffer[S];break;case"substraction":V.effects[N][U.parameter]-=U.amount*U.automation.generatedBuffer[S];break;case"additiveModulation":V.effects[N][U.parameter]+=V.effects[N][U.parameter]*U.amount*U.automation.generatedBuffer[S];break;case"substractiveModulation":V.effects[N][U.parameter]-=V.effects[N][U.parameter]*U.amount*U.automation.generatedBuffer[S];break;case"assignment":V.effects[N][U.parameter]=U.amount*U.automation.generatedBuffer[S];break;case"absoluteAssignment":V.effects[N][U.parameter]=r.abs(U.amount*U.automation.generatedBuffer[S]);break}}R[S+N]=V.effects[N].pushSample(R[S+N])*V.mix+R[S+N]*(1-V.mix)}}for(O=0;O<Q;O++){for(N=0;N<L;N++){V.effects[N][V.automation[O].parameter]=M[O][N]}}return R};g.Automation=u;g.EffectChain=t;g.EffectClass=F;g.BufferEffect=E;g.GeneratorClass=f;g.codecs=g.Codec=y;g.plugins=p;g.version="0.4.7";return g}).call(typeof exports==="undefined"?{}:this,this.window||global,Math,Object,Array);