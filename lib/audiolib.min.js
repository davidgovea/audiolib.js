this.audioLib=(function AUDIOLIB(z,m,D,t){var v=z.Float32Array||t,g=this;function f(H){var I=new v(H);I.subarray=I.subarray||I.slice;return I}g.Float32Array=f;var E=(function(){if(D.defineProperty){return D.defineProperty}else{if(D.prototype.__defineGetter__){return function(H,J,I){I.get&&H.__defineGetter__(J,I.get);I.set&&H.__defineSetter__(J,I.set)}}}}());function n(J,K,I,H){if(E){E(J,K,{get:function(){return I},enumerable:!!H})}else{J[K]=I}}n(g,"__define",E);n(g,"__defineConst",n);function w(K){var I=arguments,H=I.length,J,L;for(J=1;J<H;J++){for(L in I[J]){if(I[J].hasOwnProperty(L)){K[L]=I[J][L]}}}return K}n(g,"__extend",w);function u(I,K,J){var H;for(H in I){(I.hasOwnProperty(H)||J)&&K.call(I,I[H],H)}return I}n(g,"__enum",u);function C(J,L,K,I,H){this.sampleRate=isNaN(J)?this.sampleRate:J;this.attack=isNaN(L)?this.attack:L;this.decay=isNaN(K)?this.decay:K;this.sustain=isNaN(I)?this.sustain:I;this.release=isNaN(H)?this.release:H}C.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,value:0,state:3,gate:false,generate:function(){this.states[this.state].call(this);return this.value},getMix:function(){return this.value},triggerGate:function(H){this.gate=H;this.state=H?0:3},states:[function(){this.value+=1000/this.sampleRate/this.attack;if(this.value>=1){this.state=1}},function(){this.value-=1000/this.sampleRate/this.decay*this.sustain;if(this.value<=this.sustain){this.state=2}},function(){this.value=this.sustain},function(){this.value=m.max(0,this.value-1000/this.sampleRate/this.release)}]};function A(L,I,K,M){var J=this,H=0;this.sampleRate=isNaN(L)?this.sampleRate:L;this.stepLength=isNaN(I)?this.stepLength:I;this.steps=K||[1,0];this.attack=isNaN(M)?this.attack:M}A.prototype={sampleRate:44100,stepLength:200,steps:null,value:0,attack:0,phase:0,generate:function(){var P=this,K=P.sampleRate/1000*P.stepLength,N=P.steps,L=K*N.length,J,O,H,M,I;P.phase=(P.phase+1)%L;J=P.phase/L*N.length;O=J%1;J=m.floor(J);H=(J||N.length)-1;M=N[J]-N[H];I=N[J];if(O<P.attack){I-=M-M/P.attack*O}P.value=I;return I},getMix:function(){return this.value},triggerGate:function(){this.phase=0}};function b(N,L,I,H,M,K){var J=this,O=0;J.inputs=[0,0];J.outputs=[0,0];J.sampleRate=N;J.coefs={a0:L,a1:I,a2:H,b1:M,b2:K};J.pushSample=function(Q){var S=J.coefs,P=J.inputs,R=J.outputs;O=S.a0*Q+S.a1*P[0]+S.a2*P[1]-S.b1*R[0]-S.b2*R[1];P.pop();P.unshift(Q);R.pop();R.unshift(O);return O};J.getMix=function(){return O};J.reset=function(){J.inputs=[0,0];J.outputs=[0,0]}}b.LowPass=function(T,L,N){var O=2*m.PI*L/T,U=m.cos(O),H=m.sin(O),M=H/(2*N),S=(1-U)/2,R=1-U,P=S,K=1+M,J=-2*U,I=1-M;return new b(T,S/K,R/K,P/K,J/K,I/K)};b.HighPass=function(T,L,N){var O=2*m.PI*L/T,U=m.cos(O),H=m.sin(O),M=H/(2*N),S=(1+U)/2,R=-(1+U),P=S,K=1+M,J=-2*U,I=1-M;return new g.BiquadFilter(T,S/K,R/K,P/K,J/K,I/K)};b.AllPass=function(T,M,N){var O=2*m.PI*M/T,U=m.cos(O),H=m.sin(O),L=H/(2*N),S=1-L,R=-2*U,P=1+L,K=P,J=R,I=S;return new g.BiquadFilter(T,S/K,R/K,P/K,J/K,I/K)};b.BandPass=function(T,J,P){var O=2*m.PI*J/T,U=m.cos(O),H=m.sin(O),M=m.log(2)/2*P*O/H,N=H*(m.exp(M)-m.exp(-M))/2,S=N,R=0,Q=-N,L=1+N,K=-2*U,I=1-N;return new g.BiquadFilter(T,S/L,R/L,Q/L,K/L,I/L)};function G(I,K){var H=this,J=0;H.sampleRate=I;H.resolution=K?m.pow(2,K-1):m.pow(2,8-1);H.pushSample=function(L){J=m.floor(L*H.resolution+0.5)/H.resolution;return J};H.getMix=function(){return J}}function y(O,L,K,H){var P=this,J,I,N;P.delayTime=L||30;P.depth=K||3;P.freq=H||0.1;function M(){J=new f(P.sampleRate*0.1);I=0;var R,Q=J.length;for(R=0;R<Q;R++){J[R]=0}}P.sampleRate=O;P.osc=new e(O,H);P.calcCoeff=M;P.pushSample=function(R){if(++I>=J.length){I=0}J[I]=R;P.osc.generate();var Q=P.delayTime+P.osc.getMix()*P.depth;Q*=P.sampleRate/1000;Q=I-m.floor(Q);while(Q<0){Q+=J.length}N=J[Q];return N};P.getMix=function(){return N};M()}function F(J,I,L){var H=this,K=0;H.sampleRate=J;H.scale=I||1;H.gain=L||0.5;H.pushSample=function(M){M/=H.scale;K=(1+H.gain)*M-H.gain*M*M*M;return K};H.getMix=function(){return K}}function j(J,K,H){var I=this;I.time=isNaN(K)?I.time:K;I.feedback=isNaN(H)?I.feedback:H;I.reset(J)}j.prototype={sampleRate:1,bufferPos:0,buffer:null,time:1000,feedback:0,sample:0,_rstf:1,pushSample:function(J){var I=this,H=I.buffer;H[I.bufferPos++]+=J;if(I.bufferPos>I.time*I._rstf){I.bufferPos=0}I.sample=H[I.bufferPos];H[I.bufferPos]*=I.feedback;return I.sample},getMix:function(){return this.sample},resample:function(J){var H=this,I=H.time/J;H.buffer=g.Sampler.resample(H.buffer,J);H.time=J;H.bufferPos=m.round(I*H.bufferPos);return H.buffer},reset:function(J,M){var H=this,I=H.buffer,K,L;J=isNaN(J)?H.sampleRate:J;L=H.sampleRate/J;H.buffer=new f(J*j.MAX_DELAY);H.bufferPos=m.round(L*H.bufferPos);H._rstf=1/1000*J;if(M){I=g.Sampler.resample(I,L);for(K=0;K<I.length&&K<H.buffer.length;K++){H.buffer[K]=I[K]}}return H.buffer}};j.MAX_DELAY=2;function r(H){var L=new h(H,720.484),K=new h(H,723.431),J=new h(H,1),I=0;this.gain=4;this.master=1;this.sampleRate=H;this.filters=[L,K,J];this.pushSample=function(M){L.pushSample(M);I=L.getMix(1)*this.gain;I=m.atan(I)+I;if(I>0.4){I=0.4}else{if(I<-0.4){I=-0.4}}K.pushSample(I);J.pushSample(K.getMix(0));I=J.getMix(1)*this.master;return I};this.getMix=function(){return I}}function q(H,I){this.sampleRate=isNaN(H)?this.sampleRate:H;this.gain=isNaN(I)?this.gain:I}q.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(H){this.sample=H*this.gain;return this.sample},getMix:function(){return this.sample}};function h(M,I,T,R){var U=this,O=[0,0,0,0],H,K,S,J,Q=m.sin,L=m.min,N=m.pow;U.cutoff=!I?20000:I;U.resonance=!T?0.1:T;U.samplerate=M;U.type=R||0;function P(){H=2*Q(m.PI*L(0.25,U.cutoff/(U.samplerate*2)));K=L(2*(1-N(U.resonance,0.25)),L(2,2/H-H*0.5))}U.pushSample=function(V){if(S!==U.cutoff||J!==U.resonance){P();S=U.cutoff;J=U.resonance}O[3]=V-K*O[2];O[0]=O[0]+H*O[2];O[1]=O[3]-O[0];O[2]=H*O[1]+O[2];O[3]=V-K*O[2];O[0]=O[0]+H*O[2];O[1]=O[3]-O[0];O[2]=H*O[1]+O[2];return O[U.type]};U.getMix=function(V){return O[V||U.type]}}function x(M,J,T){var U=this,R=0,L=0,O=m.PI*2,Q,I,H,P,S,K;U.cutoff=!J?20000:J;U.resonance=!T?1:T;U.samplerate=M;function N(){Q=O*U.cutoff/U.samplerate;I=1-Q/(2*(U.resonance+0.5/(1+Q))+Q-2);H=I*I;P=H+1-2*m.cos(Q)*I}U.pushSample=function(V){if(S!==U.cutoff||K!==U.resonance){N();S=U.cutoff;K=U.resonance}R+=(V-L)*P;L+=R;R*=H;return L};U.getMix=function(){return L};N()}function e(I,J){var H=this;H.frequency=isNaN(J)?440:J;H.waveTable=new f(1);H.sampleRate=I;H.waveShapes=H.waveShapes.slice(0)}(function(J,K,I,H){I=e.prototype={sampleRate:1,frequency:440,phase:0,phaseOffset:0,pulseWidth:0.5,fm:0,waveShape:"sine",_p:0,generate:function(){var L=this,N=+L.frequency,M=L.pulseWidth,O=L.phase;N+=N*L.fm;L.phase=(O+N/L.sampleRate/2)%1;O=(L.phase+L.phaseOffset)%1;L._p=O<M?O/M:(O-M)/(1-M)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(L){this.phase=this._p=isNaN(L)?0:L},setWavetable:function(L){this.waveTable=L;return true},sine:function(){return m.sin(this._p*J)},triangle:function(){return this._p<0.5?4*this._p-1:3-4*this._p},square:function(){return this._p<0.5?-1:1},sawtooth:function(){return 1-this._p*2},invSawtooth:function(){return this._p*2-1},pulse:function(){return this._p<0.5?this._p<0.25?this._p*8-1:1-(this._p-0.25)*8:-1},wavetable:function(){return g.Sampler.interpolate(this.wavetable,this._p*this.wavetable.length)},waveShapes:[]};for(H=0;H<K.length;H++){I[H]=I[K[H]];I.waveShapes.push(I[H])}e.WaveShape=function(M,L){if(L){this.prototype[M]=L}return this.prototype[M]};e.createMixWave=function(M,P){var L=P.length,O,N;return this.WaveShape(M,function(){O=0;for(N=0;N<L;N++){O+=this[P[N].shape]()*P[N].mix}return O})}}(m.PI*2,["sine","triangle","pulse","sawtooth","invSawtooth","square"]));function d(I,J){var H=this;H.voices=[];H.sampleRate=I;H.pitch=isNaN(J)?440:H.pitch}d.prototype={sampleRate:1,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(M){M=isNaN(M)?this.pitch:M;var I=this,L=1,K=I.sampleRate,N=K*I.delayStart,H=I.sampleSize-K*I.delayEnd-1,J={f:M,p:N,s:L,l:H};I.voices.push(J);while(I.voices.length>I.maxVoices){H=I.voices.shift();H.onend&&H.onend()}return J},generate:function(){var H=this.voices,I,J;for(I=0;I<H.length;I++){J=H[I];J.p+=J.s;J.p>J.l&&H.splice(I--,1)&&J.onend&&J.onend()}},getMix:function(K){var H=this.voices,J=0,I;K=K||0;if(this.samples[K]){for(I=0;I<H.length;I++){J+=0.8*d.interpolate(this.samples[K],H[I].p)}}return J},load:function(L,K){var H=this,I=H.samples=d.deinterleave(L.data,L.channelCount),J;console.log(I[0].length);if(K){console.log("resampling");for(J=0;J<I.length;J++){I[J]=d.resample(I[J],L.sampleRate,H.sampleRate)}}console.log(I[0][150]);H.sample=L.data;H.samples=I;H.data=L;H.sampleSize=I[0].length}};(function(){function H(I,J){if(I&&J){H[I]=J}else{if(I&&H[I] instanceof Function){d.interpolate=H[I]}}return H[I]}d.interpolation=H;H("linear",function(I,M){var L=m.floor(M),K=L+1,J=M-L;K=K<I.length?K:0;return I[L]*(1-J)+I[K]*J});H("nearest",function(I,J){return J>=I.length-0.5?I[0]:I[m.round(J)]});H("linear")}());d.resample=function(O,H,R,S,J){console.log("resampling");var N=arguments.length,L=N===2?H:N===3?S/R:S/H*J/R,M=O.length,I=m.ceil(M/L),Q=new f(I),P,K;for(P=0,K=0;P<M;P+=L){Q[K++]=d.interpolate(O,P)}return Q};d.deinterleave=function(I,M){console.log("deinter");var H=I.length,L=H/M,J=[],K,N;for(K=0;K<M;K++){J[K]=new f(L);for(N=0;N<L;N++){J[K][N]=I[N*M+K]}}return J};d.interleave=function(J){var L=J.length,I=J[0].length,H=new f(I*L),K,M;for(K=0;K<L;K++){for(M=0;M<I;M++){H[K+M*L]=J[K][M]}}return H};d.mix=function(J){var I=[].slice.call(arguments,1),H=J.length,K,L;for(L=0;L<I.length;L++){for(K=0;K<H;K++){J[K]+=J[L][K]}}return J};function B(J,K,I){var H=this;H.notes=[];H.sampleRate=J;H.noteTime=isNaN(K)?250:K;H.noteLength=J*0.001*H.noteTime;H.zero=new f(H.noteLength);H.cb=I}B.prototype={pos:0,looping:false,generate:function(){var H=this,J,I;if((H.pos+=1)===H.noteLength){J=H.notes,I=J.shift();if(H.looping){J.push(I)}H.pos=0;H.cb()}},getMix:function(){var H=this,I=H.notes[0]||H.zero;return I[H.pos]},addNote:function(I){var H=this,L=H.noteLength,K=new f(L),J=0;for(J=0;J<L;J++){K[J]=I(J)}H.notes.push(K)},addBuffer:function(H){this.notes.push(H)},getNoteLength:function(){return this.noteLength},getNoteCount:function(){return this.notes.length-1},setLooping:function(H){this.looping=(typeof H==="undefined")?true:H},reset:function(){this.notes=[];this.pos=0}};(function(H){function M(T){var V,U=T.length,S={};for(V=0;V<U;V++){S[T[V]]=true}return S}var P=M([256,512,1024,2048,4096,8192,16384]),I=M([48000,44100,22050]),R=String.fromCharCode;function Q(X,W,V,U){var T=Q.devices,S;for(S in T){if(T.hasOwnProperty(S)&&T[S].enabled){try{return new T[S](X,W,V,U)}catch(Y){}}}throw"No audio device available."}function J(S){this.boundTo=S;this.buffers=[];S.activeRecordings.push(this)}J.prototype={add:function(S){this.buffers.push(S)},clear:function(){this.buffers=[]},stop:function(){var S=this.boundTo.activeRecordings,T;for(T=0;T<S.length;T++){if(S[T]===this){S.splice(T--,1)}}},join:function(){var W=0,X=0,U=this.buffers,S,Y,V,T=U.length;for(V=0;V<T;V++){W+=U[V].length}S=new f(W);for(V=0;V<T;V++){for(Y=0;Y<U[V].length;Y++){S[X+Y]=U[V][Y]}X+=U[V].length}return S}};function O(S){this.type=S}O.prototype={record:function(){return new J(this)},recordData:function(T){var V=this.activeRecordings,U,S=V.length;for(U=0;U<S;U++){V[U].add(T)}},writeBuffers:function(U){var T=this.buffers,S=U.length,V,X,W,Y;if(T){for(W=0;W<T.length;W++){V=T[W];X=V.length;for(Y=0;Y<S&&Y<X;Y++){U[Y]+=V[Y]}T[W]=V.subarray(Y);W>=X&&T.splice(W--,1)}}},writeBuffer:function(T){var S=this.buffers=this.buffers||[];S.push(T);return S.length}};function N(ac,Z,T,ae){ae=I[ae]?ae:44100;T=P[T]?T:ae/2;var ag=this,V=0,ad=null,ab=new Audio(),aa,Y,X,W,S;function af(am,ai){var al,ak,ah;if(N.backgroundWork){if(window.MozBlobBuilder){ah=new MozBlobBuilder();ah.append('setInterval(function(){ postMessage("tic"); }, '+ai+");");ak=window.URL.createObjectURL(ah.getBlob());al=new Worker(ak);al.onmessage=function(){am()};return function(){al.terminate();window.URL.revokeObjectURL(ak)}}ak=ah=+new Date+"";function aj(an){if(an.source===window&&an.data===ak&&ah<+new Date){ah=+new Date+ai;am()}window.postMessage(ak,"*")}window.addEventListener("message",aj,true);window.postMessage(ak,"*");return function(){window.removeEventListener("message",aj)}}else{al=setInterval(am,ai);return function(){clearInterval(al)}}}function U(){if(ad){aa=ab.mozWriteAudio(ad);V+=aa;if(aa<ad.length){ad=ad.subarray(aa);return ad}ad=null}Y=ab.mozCurrentSampleOffset();X=Number(Y+T*Z-V)+0;if(X>0){W=new f(X);ac&&ac(W,ag.channelCount);ag.writeBuffers(W);ag.recordData(W);aa=ab.mozWriteAudio(W);if(aa<W.length){ad=W.subarray(aa)}V+=aa}}ab.mozSetup(Z,ae);S=af(U,20);this.kill=function(){S()};this.activeRecordings=[];this.sampleRate=ae;this.channelCount=Z;this.type="moz"}N.enabled=true;N.backgroundWork=false;N.prototype=new O("moz");function L(Z,X,V,U){U=I[U]?U:44100;V=P[V]?V:4096;var S=this,W=new (window.AudioContext||webkitAudioContext)(),Y=W.createJavaScriptNode(V,0,X);function T(ah){var aa=ah.outputBuffer,ad=aa.numberOfChannels,af,ac,ae=aa.length,ai=aa.size,ag=new t(ad),ab=new f(ae*ad);for(af=0;af<ad;af++){ag[af]=aa.getChannelData(af)}Z&&Z(ab,ad);S.writeBuffers(ab);S.recordData(ab);for(af=0;af<ae;af++){for(ac=0;ac<ad;ac++){ag[ac][af]=ab[af*ad+ac]}}}Y.onaudioprocess=T;Y.connect(W.destination);this.kill=function(){};this.activeRecordings=[];this.sampleRate=W.sampleRate;this.channelCount=X;this._context=W;this._node=Y;this._callback=T;this.type="webkit"}L.enabled=true;L.prototype=new O("webkit");function K(X,W,V,U){U=I[U]?U:44100;V=P[V]?bufferSize:8192;var S=this,Y;function T(){var Z=new f(V*W);X&&X(Z,S.channelCount);S.writeBuffers(Z);S.recordData(Z)}this.kill=function(){clearInterval(Y)};this.activeRecordings=[];setInterval(T,V/U*1000);this.sampleRate=U;this.channelCount=W;this.type="dummy"}K.enabled=true;K.prototype=new O("dummy");Q.deviceClass=O;Q.propertyEnum=M;Q.devices={moz:N,webkit:L,dummy:K};Q.Recording=J;H.AudioDevice=Q}(this));this.AudioDevice.createScheduled=function(L){var K=[],H=0,I;function J(N,Q){var M=N.length/Q,T=I.chunkSize,P=T*Q,S,O,R;H=+new Date;for(O=0;O<M;O+=T){for(S=0;S<K.length;S++){K[S].t-=T;if(K[S].t<=0){K[S].f.apply(K[S].x,K[S].a);K.splice(S--,1)}}R=O*P;L(N.subarray(R,R+P),Q)}}I=this.apply(this,[J].concat(t.prototype.splice.call(arguments,1)));I.schedule=function(O,N,M){K.push({f:O,x:N,a:M,t:((new Date-H)*0.001*this.sampleRate)})};I.chunkSize=1;return I};(function(){function H(){var J=arguments,I=J.length,L,K;for(K=0;K<I;K++){L=J[K];this.postMessage({type:"injection",code:L instanceof Function?"("+String(L)+").call(this);":L})}}g.AudioWorker=function(K,M){var I=new (window.MozBlobBuilder||window.BlobBuilder)(),J,L;I.append("var audioLib = ("+String(AUDIOLIB)+"(this, Math, Object, Array));\n");for(J=0;J<g.plugins._pluginList.length;J++){I.append("("+String(g.plugins._pluginList[J])+"());\n")}M&&I.append('this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)}, true);\n');I.append(K instanceof Function?"("+String(K)+").call(this);":K);J=window.URL.createObjectURL(I.getBlob());L=new Worker(J);L._terminate=L.terminate;L.terminate=function(){window.URL.revokeObjectURL(id);return L._terminate.call(L,arguments)};if(M){L.inject=H}return L}}());(function(I,J){var Q=String.fromCharCode,O=true,K=false;function L(R,S){return S?Q(R&255)+L(R>>8,S-1):""}function N(R,S){return S?N(R>>8,S-1)+Q(255-R&255):""}function P(R,S,T){return T?N(R,S):L(R,S)}function H(W,V){var R=W.length,U=R-1,X=0,T=J.pow,S;if(V){for(S=0;S<R;S++){X+=(255-W.charCodeAt(S))*T(256,U-S)}}else{for(S=0;S<R;S++){X+=W.charCodeAt(S)*T(256,S)}}return X}function M(V,aa,U,ad){var Z=J.pow,Y=J.floor,S=M.convertFromBinary,ab=M.convertToBinary,R=V/8,X=Z(2,V),ac=X/2,ae=ac-1,W=1/ac,T=1/ae;return ad?U?aa?function(af,ag){af=Y(af<0?af*ac+X:af*ae);return ab(af,R,ag)}:function(af,ag){return ab(Y(af*ae),R,ag)}:aa?function(af,ag){return ab(af<0?af+X:af,R,ag)}:function(af,ag){return ab(af,R,ag)}:U?aa?function(ah,ag){var af=S(ah,ag);return af>ae?(af-X)*W:af*T}:function(ag,af){return S(ag,af)*T}:aa?function(ah,ag){var af=S(ah,ag);return af>ae?af-X:af}:function(ag,af){return S(ag,af)}}M.convertToBinary=P;M.convertFromBinary=H;M.fromFloat32=M(32,O,O,O);M.toFloat32=M(32,O,O,K);M.fromFloat24=M(24,O,O,O);M.toFloat24=M(24,O,O,K);M.fromFloat16=M(16,O,O,O);M.toFloat16=M(16,O,O,K);M.fromFloat8=M(8,O,O,O);M.toFloat8=M(8,O,O,K);M.fromInt32=M(32,O,K,O);M.toInt32=M(32,O,K,K);M.fromInt16=M(16,O,K,O);M.toInt16=M(16,O,K,K);M.fromInt8=M(8,O,K,O);M.toInt8=M(8,O,K,K);M.fromUint32=M(32,K,K,O);M.toUint32=M(32,K,K,K);M.fromUint16=M(16,K,K,O);M.toUint16=M(16,K,K,K);M.fromUint8=M(8,K,K,O);M.toUint8=M(8,K,K,K);I.Binary=M}(this,m));(function(L,M){function N(O){this.data=O}var K=N.prototype={read:function(P){var O=this,Q=O.data.substr(0,P);O.skip(P);return Q},skip:function(P){var O=this,Q=O.data=O.data.substr(P);O.pointer+=P;return Q.length},readBuffer:function(P,S,U){var Q=this,T="read"+U+S,V=S/8,O=P.length,R=0;while(Q.data&&R<O){P[R++]=Q[T]()}return R}},J,I;function H(R,P,Q){var O=P/8;K["read"+R+P]=function(S){return Q(this.read(O),S)}}for(J in M){I=/to([a-z]+)([0-9]+)/i.exec(J);I&&H(I[1],I[2],M[J])}L.Stream=N;N.newType=H}(this,this.Binary));this.PCMData=(function(H,I){function J(K){return(typeof K==="string"?J.decode:J.encode)(K)}J.decodeFrame=function(N,M,K){if(M===8){var L=new (window.Uint8Array||t)(K.length);(new I(N)).readBuffer(L,8,"Uint");for(M=0;M<K.length;M++){K[M]=(L[M]-127.5)*127.5}}else{(new I(N)).readBuffer(K,M,"Float")}return K};J.encodeFrame=function(P,N){var L=H[(N===8?"fromUint":"fromFloat")+N],K=P.length,O="",M;if(N===8){for(M=0;M<K;M++){O+=L(P[M]*127.5+127.5)}}else{for(M=0;M<K;M++){O+=L(P[M])}}return O};J.decode=function(aj,ai){var N=new I(aj),T=N.read(4),ab=N.readUint32();N=new I(N.read(ab));var Q=N.read(4),S=N.read(4),Z=N.readUint32(),K=new I(N.read(Z)),M=K.readUint16(),ae=K.readUint16(),ah=K.readUint32(),O=K.readUint32(),ag=K.readUint16(),af=ag/ae,R=K.readUint16(),L,V,X,ac,aa,P,ad,Y={},U={channelCount:ae,bytesPerSample:ag/ae,sampleRate:O/ag,chunks:Y,data:aa};console.log("channels "+ae);function W(){L=N.read(4);V=N.readUint32();ac=N.read(V);P=Y[L]=Y[L]||[];if(L==="data"){X=~~(V/af);aa=U.data=new (typeof f!=="undefined"?f:t)(X);J.decodeFrame(ac,af*8,aa)}else{P.push(ac)}ai&&(N.data?setTimeout(W,1):ai(U))}if(ai){N.data?W():ai(U)}else{while(N.data){W()}}return U};J.encode=function(ac,aa){var W=H.fromUint32,ad=H.fromUint16,T=ac.data,K=ac.sampleRate,O=ac.channelCount||1,Y=ac.bytesPerSample||1,P=Y*8,M=O*Y,Z=K*M,N=T.length,L=N*Y,S=m.pow(2,P-1)-1,R=[],Q="",ab,X,U,V;R.push("fmt "+W(16)+ad(1)+ad(O)+W(K)+W(Z)+ad(M)+ad(P));R.push("data"+W(L)+J.encodeFrame(T,P));V=ac.chunks;if(V){for(X in V){if(V.hasOwnProperty(X)){ab=V[X];for(U=0;U<ab.length;U++){Q=ab[U];R.push(X+W(Q.length)+Q)}}}}R=R.join("");R="RIFF"+W(R.length)+"WAVE"+R;aa&&setTimeout(function(){aa(R)},1);return R};return J}(this.Binary,this.Stream));(function(I,J){var P=J.sin,T=J.cos,S=J.sqrt,N=J.floor,O=J.pow,H=J.ln2,M=J.PI,L=M*2;function K(V,U,W){V.sampleRate=U;V.bufferSize=W;V.bandWidth=0.5*W*U*0.5;V.spectrum=new f(W*0.5);V.real=new f(W);V.imag=new f(W);V.peakBand=V.peak=0;V.getBandFrequency=function(X){return this.bandwidth*X+this.bandwidth*0.5};V.calculateSpectrum=function(){var ah=this,ad=ah.spectrum,ae=ah.real,X=ah.imag,ag=0.5*ah.bufferSize,Y=S,ac=W*0.5,ab,af,aa,Z;for(Z=0;Z<ac;Z++){ab=ae[Z];af=X[Z];aa=ag*Y(ab*ab+af*af);if(aa>ah.peak){ah.peakBand=Z;ah.peak=aa}}}}function R(V,U,W){return new R[V](U,W)}function Q(V,aa){var U=this,Y=aa*aa*0.5,X=new f(Y),Z=new f(Y),W;K(U,V,aa);for(W=0;W<Y;W++){X[W]=P(W*L/aa);Z[W]=T(W*L/aa)}U.forward=function(af){var ak=this,ai=ak.real,ab=ak.imag,ah=ak.bufferSize*0.5,ad=af.length,ag,aj,ae,ac,al;for(ae=0;ae<ah;ae++){ag=aj=0;for(ac=0;ac<ad;ac++){ag+=Z[al=ae*ac]*af[ac];aj+=X[al]*af[ac]}ai[ae]=ag;ab[ae]=aj}return ak.calculateSpectrum()}}I.FourierTransform=R;R.DFT=Q}(this,m));g.ADSREnvelope=C;g.StepSequencer=A;g.BiquadFilter=b;g.BitCrusher=G;g.Chorus=y;g.Compressor=F;g.Delay=j;g.Distortion=r;g.GainController=q;g.IIRFilter=h;g.LP12Filter=x;g.Oscillator=e;g.Sampler=d;function p(){}p.prototype={type:"effect",sink:true,source:true,mix:0.5,join:function(){return s.apply(0,[this].concat(t.prototype.splice.call(arguments,0)))},addPreProcessing:function(H){H.pushSample=this.pushSample;this.pushSample=function(){H.apply(this,arguments);return H.pushSample.apply(this,arguments)}},removePreProcessing:function(I){var H;while(H=this.pushSample.pushSample){if(H===I||!I){this.pushSample=H;I.pushSample=null}}}};function s(){var H=t.prototype.splice.call(arguments,0),I=H.prototype=s.prototype;for(i in I){if(I.hasOwnProperty(i)){H[i]=I[i]}}return H}(function(H){s.prototype=H;H.pushSample=function(L){var I=this,K,J;for(J=0;J<I.length;J++){K=I[J].mix;L=I[J].pushSample(L)*K+L*(1-K)}return L}}(new p()));function l(J,I,H){this.channelCount=I;this.effects=[];function K(){J.apply(this,H)}K.prototype=J.prototype;while(I--){this.effects.push(new K())}}l.prototype={mix:0.5,append:function(I){var J=this,L=J.channelCount,H=I.length,K,M;for(K=0;K<H;K+=L){for(M=0;M<L;M++){I[K+M]=J.effects[M].pushSample(I[K+M])*J.mix+I[K+M]*(1-J.mix)}}return I},join:function(){return BufferEffectChain.apply(0,[this].concat(t.prototype.splice.call(arguments,0)))},addPreProcessing:function(){var H;for(H=0;H<this.effects.length;H++){this.effects[H].addPreProcessing.apply(this.effects[H],arguments)}},removePreProcessing:function(){var H;for(H=0;H<this.effects.length;H++){this.effects[H].removePreProcessing.apply(this.effects[H],arguments)}},addAutomation:function(){return g.Automation.apply(g,[this].concat([].slice.call(arguments)))}};function k(){}k.prototype={type:"generator",source:true,mix:1,generatedBuffer:null,append:function(I,K){var H=I.length,J,L;K=K||1;for(J=0;J<H;J+=K){this.generate();for(L=0;L<K;L++){I[J+L]=this.getMix(L)*this.mix+I[J+L]}}return I},addPreProcessing:function(H){H.generate=this.generate;this.generate=function(){H.apply(this,arguments);return H.generate.apply(this,arguments)}},removePreProcessing:function(I){var H;while(H=this.generate.generate){if(H===I||!I){this.generate=H;I.generate=null}}},addAutomation:function(){return g.Automation.apply(g,[this].concat([].slice.call(arguments)))},generateBuffer:function(I){this.generatedBuffer=new f(I);var H;for(H=0;H<I;H++){this.generate();this.generatedBuffer[H]=this.getMix()}}};(function(K,I){function H(L){return new g.BufferEffect(this,L,[].slice.call(arguments,1))}function J(M,N,L){if(N){L=L||N.prototype;J[M]=N;var O=N.prototype=new p();O.name=O.fxid=M;J[M].createBufferBased=H;for(M in L){if(L.hasOwnProperty(M)){O[M]=L[M]}}}return J[M]}g.effects=J;for(I=0;I<K.length;I++){J(K[I],g[K[I]],g[K[I]].prototype)}}(["BiquadFilter","BitCrusher","Chorus","Compressor","Delay","Distortion","GainController","IIRFilter","LP12Filter"]));(function(J,H){function I(L,M,K){if(M){K=K||M.prototype;I[L]=M;var N=M.prototype=new k();N.name=N.fxid=L;for(L in K){if(K.hasOwnProperty(L)){N[L]=K[L]}}}return I[L]}g.generators=I;for(H=0;H<J.length;H++){I(J[H],g[J[H]],g[J[H]].prototype)}}(["Oscillator","Sampler","ADSREnvelope","StepSequencer"]));function o(H,I){var J=H[0].toUpperCase()+H.substr(1).toLowerCase();o[H]=I;if(I.decode){g.Sampler.prototype["load"+J]=function(K){this.load.apply(this,[o[H].decode(K)].concat([].slice.call(arguments,1)))}}if(I.encode){g.AudioDevice.Recording.prototype["to"+J]=function(K){return o[H].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:K})}}return I}o("wav",g.PCMData);function a(H,I){a[H]=I;a._pluginList.push({plugin:I,name:H})}n(a,"_pluginList",[],false);function c(K,L,H,I,J){if(!K.automation){K.automation=[];if(K.type==="generator"){K.append=c.generatorAppend}else{K.append=c.effectAppend}}var H={parameter:L,automation:H,amount:isNaN(I)?1:I,type:J||"modulation"};K.automation.push(H);return H}c.generatorAppend=function(N,K){var Q=this,L=N.length,M=Q.automation.length,H=[],O,I,J,P;K=K||1;for(J=0;J<M;J++){H.push(Q[Q.automation[J].parameter])}for(O=0;O<L;O+=K){for(J=0;J<M;J++){Q[Q.automation[J].parameter]=H[J]}for(J=0;J<M;J++){P=Q.automation[J];switch(P.type){case"modulation":Q[P.parameter]*=P.amount*P.automation.generatedBuffer[O];break;case"addition":Q[P.parameter]+=P.amount*P.automation.generatedBuffer[O];break;case"substraction":Q[P.parameter]-=P.amount*P.automation.generatedBuffer[O];break;case"additiveModulation":Q[P.parameter]+=Q[P.parameter]*P.amount*P.automation.generatedBuffer[O];break;case"substractiveModulation":Q[P.parameter]-=Q[P.parameter]*P.amount*P.automation.generatedBuffer[O];break;case"assignment":Q[P.parameter]=P.amount*P.automation.generatedBuffer[O];break;case"absoluteAssignment":Q[P.parameter]=m.abs(P.amount*P.automation.generatedBuffer[O]);break}}Q.generate();for(I=0;I<K;I++){N[O+I]=Q.getMix(I)*Q.mix+N[O+I]}}for(J=0;J<M;J++){Q[Q.automation[J].parameter]=H[J]}return N};c.effectAppend=function(N){var R=this,H=R.channelCount,L=N.length,M=R.automation.length,I=[],O,J,K,P,Q;for(K=0;K<M;K++){I.push([]);for(J=0;J<H;J++){I[K].push(R.effects[J][R.automation[K].parameter])}}for(O=0;O<L;O+=H){for(J=0;J<H;J++){for(K=0;K<M;K++){Q=R.automation[K];R.effects[J][Q.parameter]=I[K][J];switch(Q.type){case"modulation":R.effects[J][Q.parameter]*=Q.amount*Q.automation.generatedBuffer[O];break;case"addition":R.effects[J][Q.parameter]+=Q.amount*Q.automation.generatedBuffer[O];break;case"substraction":R.effects[J][Q.parameter]-=Q.amount*Q.automation.generatedBuffer[O];break;case"additiveModulation":R.effects[J][Q.parameter]+=R.effects[J][Q.parameter]*Q.amount*Q.automation.generatedBuffer[O];break;case"substractiveModulation":R.effects[J][Q.parameter]-=R.effects[J][Q.parameter]*Q.amount*Q.automation.generatedBuffer[O];break;case"assignment":R.effects[J][Q.parameter]=Q.amount*Q.automation.generatedBuffer[O];break;case"absoluteAssignment":R.effects[J][Q.parameter]=m.abs(Q.amount*Q.automation.generatedBuffer[O]);break}}N[O+J]=R.effects[J].pushSample(N[O+J])*R.mix+N[O+J]*(1-R.mix)}}for(K=0;K<M;K++){for(J=0;J<H;J++){R.effects[J][R.automation[K].parameter]=I[K][J]}}return N};g.Automation=c;g.EffectChain=s;g.EffectClass=p;g.BufferEffect=l;g.GeneratorClass=k;g.codecs=g.Codec=o;g.plugins=a;g.version="0.4.7";return g}).call(typeof exports==="undefined"?{}:this,this.window||global,Math,Object,Array);