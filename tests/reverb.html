<!DOCTYPE html>
<html>
	<head>
		<script src="../lib/audiolib.js"></script>
		<script src="samples/freeverb.js"></script>
		<script>
(function(){

var	sampler, dev, sampleRate, reverb, apply,
	effect = {
		none: function(s, n){return s;},
		reverb: function(s, n){return reverb[n].pushSample(s);}
	};
apply = effect.none;

function audioProcess(buffer, channelCount){
	var	l	= buffer.length,
		i, n;
	for (i=0; i<l; i+=channelCount){
		sampler.generate();
		for (n=0; n<channelCount; n++){
			buffer[n + i] = apply(sampler.getMix(n), n);
		}
	}
}

window.onload	= function(){
	setTimeout(function(){
		dev		= audioLib.AudioDevice(audioProcess, 2);
		sampleRate	= dev.sampleRate;
		sampler		= new audioLib.Sampler(sampleRate);
		reverb		= [new audioLib.Reverb(sampleRate, false), new audioLib.Reverb(sampleRate, true)];
		
		var sample = audioLib.PCMData.decode(atob(freeverb.sample));
		
		//sample = (sampleRate === 44100) ? sample : audioLib.Sampler.resample(sample, 44100, sampleRate);
		//sampler.loadWav(atob(freeverb.sample), true);
		sampler.load(sample, (sampleRate === 44100 ? false : true));
		//if(sampleRate !== 44100) sampler.load(audioLib.Sampler.resample(sampler.sample, 44100, sampleRate))
	}, 2000);
};

window.play	= function(frequency, wet, dry){
	apply = effect.none;
	reverb[0].wet = reverb[1].wet = wet;
	reverb[0].dry = reverb[1].dry = dry;
	console.log(sampler.noteOn(frequency));
}

window.playReverb	= function(frequency, wet, dry){
	apply = effect.reverb;
	reverb[0].wet = reverb[1].wet = wet;
	reverb[0].dry = reverb[1].dry = dry;
	console.log(sampler.noteOn(frequency));
}

}());

		</script>
	</head>
	<body>
		<label for="f">Frequency</label>
		<input id="f" value="440">
		<label for="w">Wet</label>
		<input id="w" value="0.6">
		<label for="d">Dry</label>
		<input id="d" value="0.65"><br>
		<button onclick="play(document.getElementById('f').value,document.getElementById('w').value,document.getElementById('d').value)">Play</button>
		<button onclick="playReverb(document.getElementById('f').value,document.getElementById('w').value,document.getElementById('d').value)">Play Reverb</button>
	</body>
</html>
